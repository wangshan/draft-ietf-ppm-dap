<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Distributed Aggregation Protocol for Privacy Preserving Measurement</title>
<meta content="Tim Geoghegan" name="author">
<meta content="Christopher Patton" name="author">
<meta content="Eric Rescorla" name="author">
<meta content="Christopher A. Wood" name="author">
<meta content="
       There are many situations in which it is desirable to take measurements of data
which people consider sensitive. In these cases, the entity taking the
measurement is usually not interested in people's individual responses but
rather in aggregated data. Conventional methods require collecting individual
responses and then aggregating them, thus representing a threat to user privacy
and rendering many such measurements difficult and impractical. This document
describes a multi-party distributed aggregation protocol (DAP) for privacy
preserving measurement (PPM) which can be used to collect aggregate data without
revealing any individual user's data. 
    " name="description">
<meta content="xml2rfc 3.12.7" name="generator">
<meta content="draft-ietf-ppm-dap-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.7
    Python 3.9.7
    appdirs 1.4.4
    ConfigArgParse 1.3
    google-i18n-address 2.5.1
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.5
    MarkupSafe 2.0.1
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 52.0.0
    six 1.16.0
-->
<link href="draft-ietf-ppm-dap.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
dd.break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines */
  line-height: 0;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  pre + .pilcrow, svg + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
tr:nth-child(2n) > td {
  background-color: var(--background-color);
}
tr:nth-child(2n+1) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n+1) > td {
  background-color: var(--background-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 8em;
}
#identifiers dt {
  width: var(--identifier-width);
  margin: 0;
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0 0 0 calc(1em + var(--identifier-width));
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul p, #toc ul li {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table .text-left, table .text-left {
  text-align: left;
}
table .text-center, table .text-center {
  text-align: center;
}
table .text-right, table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
/* Trick: a prefix match works because only black and white are allowed */
svg [stroke="black"], svg [stroke^="#000"] {
  stroke: var(--text-color);
}
svg [stroke="white"], svg [stroke^="#fff"] {
  stroke: var(--background-color);
}
svg [fill="black"], svg [fill^="#000"], svg :not([fill]) {
  fill: var(--text-color);
}
svg [stroke="fill"], svg [fill^="#fff"] {
  fill: var(--background-color);
}
}
</style>

</head>
<body>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">DAP-PPM</td>
<td class="right">June 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Geoghegan, et al.</td>
<td class="center">Expires 3 December 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-ppm-dap-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-06-01" class="published">1 June 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-12-03">3 December 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">T. Geoghegan</div>
<div class="org">ISRG</div>
</div>
<div class="author">
      <div class="author-name">C. Patton</div>
<div class="org">Cloudflare</div>
</div>
<div class="author">
      <div class="author-name">E. Rescorla</div>
<div class="org">Mozilla</div>
</div>
<div class="author">
      <div class="author-name">C. A. Wood</div>
<div class="org">Cloudflare</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Distributed Aggregation Protocol for Privacy Preserving Measurement</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">There are many situations in which it is desirable to take measurements of data
which people consider sensitive. In these cases, the entity taking the
measurement is usually not interested in people's individual responses but
rather in aggregated data. Conventional methods require collecting individual
responses and then aggregating them, thus representing a threat to user privacy
and rendering many such measurements difficult and impractical. This document
describes a multi-party distributed aggregation protocol (DAP) for privacy
preserving measurement (PPM) which can be used to collect aggregate data without
revealing any individual user's data.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://ietf-wg-ppm.github.io/draft-ietf-ppm-dap/draft-ietf-ppm-dap.html">https://ietf-wg-ppm.github.io/draft-ietf-ppm-dap/draft-ietf-ppm-dap.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-ietf-ppm-dap/">https://datatracker.ietf.org/doc/draft-ietf-ppm-dap/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Privacy Preserving Measurement Working Group mailing list (<span><a href="mailto:ppm@ietf.org">mailto:ppm@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/ppm/">https://mailarchive.ietf.org/arch/browse/ppm/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap">https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 3 December 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-conventions-and-definitions" class="xref">Conventions and Definitions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-overview" class="xref">Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-system-architecture" class="xref">System Architecture</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-validating-inputs" class="xref">Validating Inputs</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-message-transport" class="xref">Message Transport</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-errors" class="xref">Errors</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-https-sender-authentication" class="xref">HTTPS Sender Authentication</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-protocol-definition" class="xref">Protocol Definition</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-task-configuration" class="xref">Task Configuration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-uploading-reports" class="xref">Uploading Reports</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="xref">4.2.1</a>.  <a href="#name-hpke-configuration-request" class="xref">HPKE Configuration Request</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="xref">4.2.2</a>.  <a href="#name-upload-request" class="xref">Upload Request</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.3">
                    <p id="section-toc.1-1.4.2.2.2.3.1"><a href="#section-4.2.3" class="xref">4.2.3</a>.  <a href="#name-upload-extensions" class="xref">Upload Extensions</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-verifying-and-aggregating-r" class="xref">Verifying and Aggregating Reports</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="xref">4.3.1</a>.  <a href="#name-aggregate-initialization" class="xref">Aggregate Initialization</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.2">
                    <p id="section-toc.1-1.4.2.3.2.2.1"><a href="#section-4.3.2" class="xref">4.3.2</a>.  <a href="#name-aggregate-continuation" class="xref">Aggregate Continuation</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-collecting-results" class="xref">Collecting Results</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.1">
                    <p id="section-toc.1-1.4.2.4.2.1.1"><a href="#section-4.4.1" class="xref">4.4.1</a>.  <a href="#name-collection-initialization" class="xref">Collection Initialization</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.2">
                    <p id="section-toc.1-1.4.2.4.2.2.1"><a href="#section-4.4.2" class="xref">4.4.2</a>.  <a href="#name-collection-aggregation" class="xref">Collection Aggregation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.3">
                    <p id="section-toc.1-1.4.2.4.2.3.1"><a href="#section-4.4.3" class="xref">4.4.3</a>.  <a href="#name-collection-finalization" class="xref">Collection Finalization</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.4">
                    <p id="section-toc.1-1.4.2.4.2.4.1"><a href="#section-4.4.4" class="xref">4.4.4</a>.  <a href="#name-aggregate-share-encryption" class="xref">Aggregate Share Encryption</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.5">
                    <p id="section-toc.1-1.4.2.4.2.5.1"><a href="#section-4.4.5" class="xref">4.4.5</a>.  <a href="#name-validating-batch-parameters" class="xref">Validating Batch Parameters</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.6">
                    <p id="section-toc.1-1.4.2.4.2.6.1"><a href="#section-4.4.6" class="xref">4.4.6</a>.  <a href="#name-anti-replay" class="xref">Anti-replay</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-operational-considerations" class="xref">Operational Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-protocol-participant-capabi" class="xref">Protocol participant capabilities</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="xref">5.1.1</a>.  <a href="#name-client-capabilities" class="xref">Client capabilities</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="xref">5.1.2</a>.  <a href="#name-aggregator-capabilities" class="xref">Aggregator capabilities</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.3">
                    <p id="section-toc.1-1.5.2.1.2.3.1"><a href="#section-5.1.3" class="xref">5.1.3</a>.  <a href="#name-collector-capabilities" class="xref">Collector capabilities</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-data-resolution-limitations" class="xref">Data resolution limitations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-aggregation-utility-and-sof" class="xref">Aggregation utility and soft batch deadlines</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-protocol-specific-optimizat" class="xref">Protocol-specific optimizations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.1">
                    <p id="section-toc.1-1.5.2.4.2.1.1"><a href="#section-5.4.1" class="xref">5.4.1</a>.  <a href="#name-reducing-storage-requiremen" class="xref">Reducing storage requirements</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-threat-model" class="xref">Threat model</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.1">
                    <p id="section-toc.1-1.6.2.1.2.1.1"><a href="#section-6.1.1" class="xref">6.1.1</a>.  <a href="#name-client-user" class="xref">Client/user</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.2">
                    <p id="section-toc.1-1.6.2.1.2.2.1"><a href="#section-6.1.2" class="xref">6.1.2</a>.  <a href="#name-aggregator" class="xref">Aggregator</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.3">
                    <p id="section-toc.1-1.6.2.1.2.3.1"><a href="#section-6.1.3" class="xref">6.1.3</a>.  <a href="#name-leader" class="xref">Leader</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.4">
                    <p id="section-toc.1-1.6.2.1.2.4.1"><a href="#section-6.1.4" class="xref">6.1.4</a>.  <a href="#name-collector" class="xref">Collector</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.5">
                    <p id="section-toc.1-1.6.2.1.2.5.1"><a href="#section-6.1.5" class="xref">6.1.5</a>.  <a href="#name-aggregator-collusion" class="xref">Aggregator collusion</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.6">
                    <p id="section-toc.1-1.6.2.1.2.6.1"><a href="#section-6.1.6" class="xref">6.1.6</a>.  <a href="#name-attacker-on-the-network" class="xref">Attacker on the network</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-client-authentication-or-at" class="xref">Client authentication or attestation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-anonymizing-proxies" class="xref">Anonymizing proxies</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-batch-parameters" class="xref">Batch parameters</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a href="#section-6.5" class="xref">6.5</a>.  <a href="#name-differential-privacy" class="xref">Differential privacy</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.6">
                <p id="section-toc.1-1.6.2.6.1"><a href="#section-6.6" class="xref">6.6</a>.  <a href="#name-robustness-in-the-presence-" class="xref">Robustness in the presence of malicious servers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.7">
                <p id="section-toc.1-1.6.2.7.1"><a href="#section-6.7" class="xref">6.7</a>.  <a href="#name-infrastructure-diversity" class="xref">Infrastructure diversity</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.8">
                <p id="section-toc.1-1.6.2.8.1"><a href="#section-6.8" class="xref">6.8</a>.  <a href="#name-system-requirements" class="xref">System requirements</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.8.2.1">
                    <p id="section-toc.1-1.6.2.8.2.1.1"><a href="#section-6.8.1" class="xref">6.8.1</a>.  <a href="#name-data-types" class="xref">Data types</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-protocol-message-media-type" class="xref">Protocol Message Media Types</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.1">
                    <p id="section-toc.1-1.7.2.1.2.1.1"><a href="#section-7.1.1" class="xref">7.1.1</a>.  <a href="#name-application-dap-hpke-config" class="xref">"application/dap-hpke-config" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.2">
                    <p id="section-toc.1-1.7.2.1.2.2.1"><a href="#section-7.1.2" class="xref">7.1.2</a>.  <a href="#name-message-dap-report-media-ty" class="xref">"message/dap-report" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.3">
                    <p id="section-toc.1-1.7.2.1.2.3.1"><a href="#section-7.1.3" class="xref">7.1.3</a>.  <a href="#name-message-dap-aggregate-conti" class="xref">"message/dap-aggregate-continue-req" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.4">
                    <p id="section-toc.1-1.7.2.1.2.4.1"><a href="#section-7.1.4" class="xref">7.1.4</a>.  <a href="#name-message-dap-aggregate-initi" class="xref">"message/dap-aggregate-initialize-resp" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.5">
                    <p id="section-toc.1-1.7.2.1.2.5.1"><a href="#section-7.1.5" class="xref">7.1.5</a>.  <a href="#name-message-dap-aggregate-contin" class="xref">"message/dap-aggregate-continue-req" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.6">
                    <p id="section-toc.1-1.7.2.1.2.6.1"><a href="#section-7.1.6" class="xref">7.1.6</a>.  <a href="#name-message-dap-aggregate-continu" class="xref">"message/dap-aggregate-continue-resp" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.7">
                    <p id="section-toc.1-1.7.2.1.2.7.1"><a href="#section-7.1.7" class="xref">7.1.7</a>.  <a href="#name-message-dap-aggregate-share" class="xref">"message/dap-aggregate-share-req" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.8">
                    <p id="section-toc.1-1.7.2.1.2.8.1"><a href="#section-7.1.8" class="xref">7.1.8</a>.  <a href="#name-message-dap-aggregate-share-" class="xref">"message/dap-aggregate-share-resp" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.9">
                    <p id="section-toc.1-1.7.2.1.2.9.1"><a href="#section-7.1.9" class="xref">7.1.9</a>.  <a href="#name-message-dap-collect-req-med" class="xref">"message/dap-collect-req" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.10">
                    <p id="section-toc.1-1.7.2.1.2.10.1"><a href="#section-7.1.10" class="xref">7.1.10</a>. <a href="#name-message-dap-collect-req-medi" class="xref">"message/dap-collect-req" media type</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-upload-extension-registry" class="xref">Upload Extension Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-urn-sub-namespace-for-dap-u" class="xref">URN Sub-namespace for DAP (urn:ietf:params:ppm:dap)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-acknowledgements" class="xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document describes a distributed aggregation protocol for privacy
preserving measurement. The protocol is executed by a large set of clients and a
small set of servers. The servers' goal is to compute some aggregate statistic
over the clients' inputs without learning the inputs themselves. This is made
possible by distributing the computation among the servers in such a way that,
as long as at least one of them executes the protocol honestly, no input is ever
seen in the clear by any server.<a href="#section-1-1" class="pilcrow">¶</a></p>
<div id="conventions-and-definitions">
<section id="section-1.1">
        <h3 id="name-conventions-and-definitions">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
        </h3>
<p id="section-1.1-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">The following terms are used:<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-1.1-3">
          <dt id="section-1.1-3.1">Aggregation function:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.2">
            <p id="section-1.1-3.2.1">The function computed over the users' inputs.<a href="#section-1.1-3.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.3">Aggregator:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.4">
            <p id="section-1.1-3.4.1">An endpoint that runs the input-validation protocol and accumulates input
 shares.<a href="#section-1.1-3.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.5">Batch:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.6">
            <p id="section-1.1-3.6.1">A set of reports that are aggregated into an output.<a href="#section-1.1-3.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.7">Batch duration:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.8">
            <p id="section-1.1-3.8.1">The time difference between the oldest and newest report in a batch.<a href="#section-1.1-3.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.9">Batch interval:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.10">
            <p id="section-1.1-3.10.1">A parameter of the collect or aggregate-share request that specifies the time
 range of the reports in the batch.<a href="#section-1.1-3.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.11">Client:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.12">
            <p id="section-1.1-3.12.1">The endpoint from which a user sends data to be aggregated, e.g., a web
 browser.<a href="#section-1.1-3.12.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.13">Collector:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.14">
            <p id="section-1.1-3.14.1">The endpoint that receives the output of the aggregation function.<a href="#section-1.1-3.14.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.15">Input:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.16">
            <p id="section-1.1-3.16.1">The measurement (or measurements) emitted by a client, before any encryption
 or secret sharing scheme is applied.<a href="#section-1.1-3.16.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.17">Input share:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.18">
            <p id="section-1.1-3.18.1">An aggregator's share of the output of the VDAF
 <span>[<a href="#VDAF" class="xref">VDAF</a>]</span> sharding algorithm. This algorithm is run by
 each client in order to cryptographically protect its measurement.<a href="#section-1.1-3.18.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.19">Measurement:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.20">
            <p id="section-1.1-3.20.1">A single value (e.g., a count) being reported by a client. Multiple
 measurements may be grouped into a single protocol input.<a href="#section-1.1-3.20.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.21">Minimum batch duration:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.22">
            <p id="section-1.1-3.22.1">The minimum batch duration permitted for a DAP task, i.e., the minimum time
 difference between the oldest and newest report in a batch.<a href="#section-1.1-3.22.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.23">Minimum batch size:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.24">
            <p id="section-1.1-3.24.1">The minimum number of reports in a batch.<a href="#section-1.1-3.24.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.25">Leader:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.26">
            <p id="section-1.1-3.26.1">A distinguished aggregator that coordinates input validation and data
 collection.<a href="#section-1.1-3.26.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.27">Aggregate result:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.28">
            <p id="section-1.1-3.28.1">The output of the aggregation function over a given set of reports.<a href="#section-1.1-3.28.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.29">Aggregate share:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.30">
            <p id="section-1.1-3.30.1">A share of the aggregate result emitted by an aggregator. Aggregate shares are
 reassembled by the collector into the final output.<a href="#section-1.1-3.30.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.31">Output share:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.32">
            <p id="section-1.1-3.32.1">An aggregator's share of the output of the VDAF
 <span>[<a href="#VDAF" class="xref">VDAF</a>]</span> preparation step. Many output shares are
 combined into an aggregate share via the VDAF aggregation algorithm.<a href="#section-1.1-3.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.33">Proof:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.34">
            <p id="section-1.1-3.34.1">A value generated by the client and used by the aggregators to verify the
client's input.<a href="#section-1.1-3.34.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.35">Report:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.36">
            <p id="section-1.1-3.36.1">Uploaded to the leader from the client. A report contains the secret-shared
 and encrypted input and proof.<a href="#section-1.1-3.36.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.37">Server:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.38">
            <p id="section-1.1-3.38.1">An aggregator.<a href="#section-1.1-3.38.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-1.1-4">This document uses the presentation language of <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span> to define messages
in the DAP protocol. Encoding and decoding of these messages as byte strings
also follows <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="overview">
<section id="section-2">
      <h2 id="name-overview">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
      </h2>
<p id="section-2-1">The protocol is executed by a large set of clients and a small set of servers.
We call the servers the <em>aggregators</em>. Each client's input to the protocol is a
set of measurements (e.g., counts of some user behavior). Given the input set of
measurements <code>x_1, ..., x_n</code> held by <code>n</code> users, the goal of a protocol for
privacy preserving measurement is to compute <code>y = F(p, x_1, ..., x_n)</code> for some
function <code>F</code> while revealing nothing else about the measurements.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">This protocol is extensible and allows for the addition of new cryptographic
schemes that implement the VDAF interface specified in
<span>[<a href="#VDAF" class="xref">VDAF</a>]</span>. Candidates include:<a href="#section-2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-3.1">Prio3, which allows for aggregate statistics such as sum, mean, histograms,
etc. This class of VDAFs is based on Prio <span>[<a href="#CGB17" class="xref">CGB17</a>]</span> and includes improvements
described in <span>[<a href="#BBCGGI19" class="xref">BBCGGI19</a>]</span>.<a href="#section-2-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-3.2">Poplar1, which allows for finding the most popular strings among a collection
of clients (e.g., the URL of their home page) as well as counting the number
of clients that hold a given string. This VDAF is the basis of the Poplar
protocol of <span>[<a href="#BBCGGI21" class="xref">BBCGGI21</a>]</span>, which is designed to solve the heavy hitters problem
in a privacy preserving manner.<a href="#section-2-3.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-4">This protocol is designed to work with schemes that use secret sharing. Rather
than send its input in the clear, each client shards its measurements into a
sequence of <em>input shares</em> and sends an input share to each of the aggregators.
This provides two important properties:<a href="#section-2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-5.1">It's impossible to deduce the measurement without knowing <em>all</em> of the shares.<a href="#section-2-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-5.2">It allows the aggregators to compute the final output by first aggregating up
their measurements shares locally, then combining the results to obtain the
final output.<a href="#section-2-5.2" class="pilcrow">¶</a>
</li>
      </ul>
<div id="system-architecture">
<section id="section-2.1">
        <h3 id="name-system-architecture">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-system-architecture" class="section-name selfRef">System Architecture</a>
        </h3>
<p id="section-2.1-1">The overall system architecture is shown in <a href="#pa-topology" class="xref">Figure 1</a>.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<span id="name-system-architecture-2"></span><div id="pa-topology">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-2.1-2.1">
<pre>
                    +------------+
                    |            |
+--------+          |   Helper   |
|        |          |            |
| Client +----+     +-----^------+
|        |    |           |
+--------+    |           |
              |           |
+--------+    |     +-----v------+         +-----------+
|        |    +-----&gt;            |         |           |
| Client +----------&gt;   Leader   &lt;---------&gt; Collector |
|        |    +-----&gt;            |         |           |
+--------+    |     +-----^------+         +-----------+
              |           |
+--------+    |           |
|        |    |           |
| Client +----+     +-----V------+
|        |          |            |
+--------+          |   Helper   |
                    |            |
                    +------------+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-system-architecture-2" class="selfRef">System Architecture</a>
          </figcaption></figure>
</div>
<p id="section-2.1-3">[[OPEN ISSUE: This shows two helpers, but the document only allows one for now.
https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap/issues/117]]<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">The main participants in the protocol are as follows:<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.1-5">
          <dt id="section-2.1-5.1">Collector:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-5.2">
            <p id="section-2.1-5.2.1">The entity which wants to take the measurement and ultimately receives the
 results. Any given measurement will have a single collector.<a href="#section-2.1-5.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-5.3">Client(s):</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-5.4">
            <p id="section-2.1-5.4.1">The endpoints which directly take the measurement(s) and report them to the
 DAP protocol. In order to provide reasonable levels of privacy, there must be
 a large number of clients.<a href="#section-2.1-5.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-5.5">Aggregator:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-5.6">
            <p id="section-2.1-5.6.1">An endpoint which receives report shares. Each aggregator works with the other
 aggregators to compute the final aggregate. This protocol defines two types
 of aggregators: Leaders and Helpers. For each measurement, there is a single
 leader and helper.<a href="#section-2.1-5.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-5.7">Leader:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-5.8">
            <p id="section-2.1-5.8.1">The leader is responsible for coordinating the protocol. It receives the
 encrypted shares, distributes them to the helpers, and orchestrates the
 process of computing the final measurement as requested by the collector.<a href="#section-2.1-5.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-5.9">Helper:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-5.10">
            <p id="section-2.1-5.10.1">Helpers are responsible for executing the protocol as instructed by the
 leader. The protocol is designed so that helpers can be relatively
 lightweight, with most of the state held at the leader.<a href="#section-2.1-5.10.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-2.1-6">The basic unit of DAP is the "task" which represents a single measurement
(though potentially taken over multiple time windows). The definition of a task
includes the following parameters:<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-7.1">The type of each measurement.<a href="#section-2.1-7.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-7.2">The aggregation function to compute (e.g., sum, mean, etc.) and an optional
aggregation parameter.<a href="#section-2.1-7.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-7.3">The set of aggregators and necessary cryptographic keying material to use.<a href="#section-2.1-7.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-7.4">The VDAF to execute, which to some extent is dictated by the previous
choices.<a href="#section-2.1-7.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-7.5">The minimum "batch size" of reports which can be aggregated.<a href="#section-2.1-7.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-7.6">The rate at which measurements can be taken, i.e., the "minimum batch window".<a href="#section-2.1-7.6" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.1-8">These parameters are distributed out of band to the clients and to the
aggregators. Each task is identified by a unique 32-byte ID which is used to
refer to it in protocol messages.<a href="#section-2.1-8" class="pilcrow">¶</a></p>
<p id="section-2.1-9">During the duration of the measurement, each client records its own value(s),
packages them up into a report, and sends them to the leader. Each share is
separately encrypted for each aggregator so that even though they pass through
the leader, the leader is unable to see or modify them. Depending on the
measurement, the client may only send one report or may send many reports over
time.<a href="#section-2.1-9" class="pilcrow">¶</a></p>
<p id="section-2.1-10">The leader distributes the shares to the helpers and orchestrates the process of
verifying them (see <a href="#validating-inputs" class="xref">Section 2.2</a>) and assembling them into a final
measurement for the collector. Depending on the VDAF, it may be possible to
incrementally process each report as it comes in, or may be necessary to wait
until the entire batch of reports is received.<a href="#section-2.1-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="validating-inputs">
<section id="section-2.2">
        <h3 id="name-validating-inputs">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-validating-inputs" class="section-name selfRef">Validating Inputs</a>
        </h3>
<p id="section-2.2-1">An essential task of any data collection pipeline is ensuring that the data
being aggregated is "valid". In DAP, input validation is complicated by the fact
that none of the entities other than the client ever sees the values for
individual clients.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">In order to address this problem, the aggregators engage in a secure,
multi-party computation specified by the chosen VDAF
<span>[<a href="#VDAF" class="xref">VDAF</a>]</span> in order to prepare a report for aggregation. At
the beginning of this computation, each aggregator is in possession of an input
share uploaded by the client. At the end of the computation, each aggregator is
in posession of either an "output share" that is ready to be aggregated or an
indication that a valid output share could not be computed.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3">To facilitiate this computation, the input shares generated by the client
include information used by the aggregators during aggregation in order to
validate their corresponding output shares. For example, Prio3 includes a
distributed zero-knowledge proof of the input's validity <span>[<a href="#BBCGGI19" class="xref">BBCGGI19</a>]</span> which the
aggregators can jointly verify and reject the report if it cannot be verified.
However, they do not learn anything about the individual report other than that
it is valid.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
<p id="section-2.2-4">The specific properties attested to in the proof vary depending on the
measurement being taken. For instance, if we want to measure the time the user
took performing a given task the proof might demonstrate that the value reported
was within a certain range (e.g., 0-60 seconds). By contrast, if we wanted to
report which of a set of N options the user select, the report might contain N
integers and the proof would demonstrate that N-1 were 0 and the other was 1.<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.2-5">It is important to recognize that "validity" is distinct from "correctness". For
instance, the user might have spent 30s on a task but the client might report
60s. This is a problem with any measurement system and DAP does not attempt to
address it; it merely ensures that the data is within acceptable limits, so the
client could not report 10^6s or -20s.<a href="#section-2.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="message-transport">
<section id="section-3">
      <h2 id="name-message-transport">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-message-transport" class="section-name selfRef">Message Transport</a>
      </h2>
<p id="section-3-1">Communications between DAP entities are carried over HTTPS <span>[<a href="#RFC2818" class="xref">RFC2818</a>]</span>. HTTPS
provides server authentication and confidentiality. When client authenticaiton
is also required, the client uses the mechanism described in
<a href="#https-sender-auth" class="xref">Section 3.2</a>.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="errors">
<section id="section-3.1">
        <h3 id="name-errors">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-errors" class="section-name selfRef">Errors</a>
        </h3>
<p id="section-3.1-1">Errors can be reported in DAP both at the HTTP layer and within challenge
objects as defined in <a href="#iana-considerations" class="xref">Section 7</a>. DAP servers can return responses
with an HTTP error response code (4XX or 5XX). For example, if the client
submits a request using a method not allowed in this document, then the server
<span class="bcp14">MAY</span> return HTTP status code 405 Method Not Allowed.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">When the server responds with an error status, it <span class="bcp14">SHOULD</span> provide additional
information using a problem document <span>[<a href="#RFC7807" class="xref">RFC7807</a>]</span>. To facilitate automatic
response to errors, this document defines the following standard tokens for use
in the "type" field (within the DAP URN namespace
"urn:ietf:params:ppm:dap:error:"):<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Type</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">unrecognizedMessage</td>
              <td class="text-left" rowspan="1" colspan="1">The message type for a response was incorrect or the payload was malformed.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">unrecognizedTask</td>
              <td class="text-left" rowspan="1" colspan="1">An endpoint received a message with an unknown task ID.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">outdatedConfig</td>
              <td class="text-left" rowspan="1" colspan="1">The message was generated using an outdated configuration.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">reportTooLate</td>
              <td class="text-left" rowspan="1" colspan="1">Report could not be processed because it arrived too late.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">reportTooEarly</td>
              <td class="text-left" rowspan="1" colspan="1">Report could not be processed because its timestamp is too far in the future.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">batchInvalid</td>
              <td class="text-left" rowspan="1" colspan="1">A collect or aggregate-share request was made with invalid batch parameters.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">insufficientBatchSize</td>
              <td class="text-left" rowspan="1" colspan="1">There are not enough reports in the batch interval to satisfy the task's minimum batch size.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">batchLifetimeExceeded</td>
              <td class="text-left" rowspan="1" colspan="1">The batch lifetime has been exceeded for one or more reports included in the batch interval.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">batchMismatch</td>
              <td class="text-left" rowspan="1" colspan="1">Aggregators disagree on the report shares that were aggregated in a batch.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">unauthorizedRequest</td>
              <td class="text-left" rowspan="1" colspan="1">Authentication of an HTTP request failed (see <a href="#https-sender-auth" class="xref">Section 3.2</a>).</td>
            </tr>
          </tbody>
        </table>
<p id="section-3.1-4">This list is not exhaustive. The server <span class="bcp14">MAY</span> return errors set to a URI other
than those defined above. Servers <span class="bcp14">MUST NOT</span> use the DAP URN namespace for errors
not listed in the appropriate IANA registry (see <a href="#urn-space" class="xref">Section 7.3</a>). Clients
<span class="bcp14">SHOULD</span> display the "detail" field of all errors. The "instance" value <span class="bcp14">MUST</span> be
the endpoint to which the request was targeted. The problem document <span class="bcp14">MUST</span> also
include a "taskid" member which contains the associated DAP task ID (this value
is always known, see <a href="#task-configuration" class="xref">Section 4.1</a>), encoded in Base 64 using the URL
and filename safe alphabet with no padding defined in sections 5 and 3.2 of
<span>[<a href="#RFC4648" class="xref">RFC4648</a>]</span>.<a href="#section-3.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1-5">In the remainder of this document, we use the tokens in the table above to refer
to error types, rather than the full URNs. For example, an "error of type
'unrecognizedMessage'" refers to an error document with "type" value
"urn:ietf:params:ppm:dap:error:unrecognizedMessage".<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6">This document uses the verbs "abort" and "alert with <code>[some error message]</code>" to
describe how protocol participants react to various error conditions.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="https-sender-auth">
<section id="section-3.2">
        <h3 id="name-https-sender-authentication">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-https-sender-authentication" class="section-name selfRef">HTTPS Sender Authentication</a>
        </h3>
<p id="section-3.2-1">Some HTTP requests in the DAP protocol require the sender to authenticate its
request. It does so as described here.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">Prior to the start of the protocol, the sender and receiver arrange to share a
secret sender-specific API token, which <span class="bcp14">MUST</span> be suitable for representation in
an HTTP header.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">For requests requiring authentication, the sender includes a "DAP-Auth-Token"
header in its HTTP request containing the API token.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<p id="section-3.2-4">To authenticate the request, the receiver looks up the token for the
sender as determined by the task configuration. (See <a href="#task-configuration" class="xref">Section 4.1</a>.) If
the value of the "DAP-Auth-Token" header does not match the token, then
the receiver <span class="bcp14">MUST</span> abort with error "unauthorizedRequest" and HTTP status code
403 Forbidden.<a href="#section-3.2-4" class="pilcrow">¶</a></p>
<p id="section-3.2-5">[OPEN ISSUE: This simple bearer-token scheme is meant to unblock interop
testing. Eventually it should be replaced with a more secure authentication
mechanism, e.g., TLS client certificates. See
https://mailarchive.ietf.org/arch/msg/ppm/z65FK8kOU27Dt38WNhpI6apc2so/ for
details.]<a href="#section-3.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="protocol-definition">
<section id="section-4">
      <h2 id="name-protocol-definition">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-protocol-definition" class="section-name selfRef">Protocol Definition</a>
      </h2>
<p id="section-4-1">DAP has three major interactions which need to be defined:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1">Uploading reports from the client to the aggregators, specified in <a href="#upload-flow" class="xref">Section 4.2</a><a href="#section-4-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-2.2">Computing the results of a given measurement, specified in <a href="#aggregate-flow" class="xref">Section 4.3</a><a href="#section-4-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-2.3">Collecting aggregated results, specified in <a href="#collect-flow" class="xref">Section 4.4</a><a href="#section-4-2.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-4-3">We start with some basic type definitions used in other messages.<a href="#section-4-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4-4">
<pre>
/* ASCII encoded URL. e.g., "https://example.com" */
opaque Url&lt;1..2^16-1&gt;;

Duration uint64; /* Number of seconds elapsed between two instants */

Time uint64; /* seconds elapsed since start of UNIX epoch */

/* An interval of time of length duration, where start is included and (start +
duration) is excluded. */
struct {
  Time start;
  Duration duration;
} Interval;

/* A nonce used to uniquely identify a report in the context of a DAP task. It
includes the time at which the report was generated and a random, 64-bit
integer. */
struct {
  Time time;
  uint64 rand;
} Nonce;

/* The various roles in the DAP protocol. */
enum {
  collector(0),
  client(1),
  leader(2),
  helper(3),
} Role;

/* Identifier for a server's HPKE configuration */
uint8 HpkeConfigId;

/* An HPKE ciphertext. */
struct {
  HpkeConfigId config_id;    // config ID
  opaque enc&lt;1..2^16-1&gt;;     // encapsulated HPKE key
  opaque payload&lt;1..2^16-1&gt;; // ciphertext
} HpkeCiphertext;
</pre><a href="#section-4-4" class="pilcrow">¶</a>
</div>
<div id="task-configuration">
<section id="section-4.1">
        <h3 id="name-task-configuration">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-task-configuration" class="section-name selfRef">Task Configuration</a>
        </h3>
<p id="section-4.1-1">Prior to the start of execution of the protocol, each participant must agree on
the configuration for each task. A task is uniquely identified by its task ID:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-2">
<pre>
opaque TaskId[32];
</pre><a href="#section-4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1-3">A <code>TaskId</code> is a globally unique sequence of bytes. It is <span class="bcp14">RECOMMENDED</span> that this
be set to a random string output by a cryptographically secure pseudorandom
number generator. Each task has the following parameters associated with it:<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-4.1">
            <code>aggregator_endpoints</code>: A list of URLs relative to which an aggregator's API
endpoints can be found. Each endpoint's list <span class="bcp14">MUST</span> be in the same order. The
leader's endpoint <span class="bcp14">MUST</span> be the first in the list. The order of the
<code>encrypted_input_shares</code> in a <code>Report</code> (see <a href="#upload-flow" class="xref">Section 4.2</a>) <span class="bcp14">MUST</span> be the
same as the order in which aggregators appear in this list.<a href="#section-4.1-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-4.2">
            <code>max_batch_lifetime</code>: The maximum number of times a batch of reports may be
used in collect requests.<a href="#section-4.1-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-4.3">
            <code>min_batch_size</code>: The minimum number of reports that appear in a batch.<a href="#section-4.1-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-4.4">
            <code>min_batch_duration</code>: The minimum time difference between the oldest and
newest report in a batch. This defines the boundaries with which the batch
interval of each collect request must be aligned. (See
<a href="#batch-parameter-validation" class="xref">Section 4.4.5</a>.)<a href="#section-4.1-4.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-4.5">A unique identifier for the VDAF instance used for the task, including the
type of measurement associated with the task.<a href="#section-4.1-4.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.1-5">In addition, in order to facilitate the aggregation and collect protocols, each
of the aggregators is configured with following parameters:<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-6.1">
            <code>collector_config</code>: The HPKE configuration of the collector (described in
<a href="#hpke-config" class="xref">Section 4.2.1</a>).<a href="#section-4.1-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-6.2">
            <code>vdaf_verify_param</code>: The aggregator's VDAF verification parameter output by
the setup algorithm computed jointly by the aggregators before the start of the
DAP protocol <span>[<a href="#VDAF" class="xref">VDAF</a>]</span>). [OPEN ISSUE: This is yet
to be specified. See issue#161.]<a href="#section-4.1-6.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.1-7">The helper stores a bearer token used to authenticate HTTP requests from the
leader. Likewise, the leader stores a bearer token to authenticate HTTP request
from the collector. The authentication mechanism is described in
<a href="#https-sender-auth" class="xref">Section 3.2</a>.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1-8">Finally, the collector is configured with the HPKE secret key corresponding to
<code>collector_hpke_config</code>.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upload-flow">
<section id="section-4.2">
        <h3 id="name-uploading-reports">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-uploading-reports" class="section-name selfRef">Uploading Reports</a>
        </h3>
<p id="section-4.2-1">Clients periodically upload reports to the leader, which then distributes the
individual shares to each helper.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div id="hpke-config">
<section id="section-4.2.1">
          <h4 id="name-hpke-configuration-request">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-hpke-configuration-request" class="section-name selfRef">HPKE Configuration Request</a>
          </h4>
<p id="section-4.2.1-1">Before the client can upload its report to the leader, it must know the public
key of each of the aggregators. These are retrieved from each aggregator by
sending an HTTP GET request to <code>[aggregator]/hpke_config?task_id=[task-id]</code>, where
<code>[aggregator]</code> is the aggregator's endpoint URL, obtained from the task
parameters, and <code>[task-id]</code> is the task ID obtained from the task parameters,
encoded in Base 64 with URL and filename safe alphabet with no padding, as
specified in sections 5 and 3.2 of <span>[<a href="#RFC4648" class="xref">RFC4648</a>]</span>. If the aggregator does not
recognize the task ID, then it responds with HTTP status code 404 Not Found and
an error of type <code>unrecognizedTask</code>. The aggregator responds to well-formed
requests with HTTP status code 200 OK and an <code>HpkeConfig</code> value:<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
<p id="section-4.2.1-2">[TODO: Allow aggregators to return HTTP status code 403 Forbidden in deployments
that use authentication to avoid leaking information about which tasks exist.]<a href="#section-4.2.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2.1-3">
<pre>
struct {
  HpkeConfigId id;
  HpkeKemId kem_id;
  HpkeKdfId kdf_id;
  HpkeAeadKdfId aead_id;
  HpkePublicKey public_key;
} HpkeConfig;

opaque HpkePublicKey&lt;1..2^16-1&gt;;
uint16 HpkeAeadId; // Defined in RFC9180
uint16 HpkeKemId;  // Defined in RFC9180
uint16 HpkeKdfId;  // Defined in RFC9180
</pre><a href="#section-4.2.1-3" class="pilcrow">¶</a>
</div>
<p id="section-4.2.1-4">[OPEN ISSUE: Decide whether to expand the width of the id, or support multiple
cipher suites (a la OHTTP/ECH).]<a href="#section-4.2.1-4" class="pilcrow">¶</a></p>
<p id="section-4.2.1-5">The client <span class="bcp14">MUST</span> abort if any of the following happen for any HPKE config
request:<a href="#section-4.2.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-6.1">the client and aggregator failed to establish a secure,
aggregator-authenticated channel;<a href="#section-4.2.1-6.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-6.2">the GET request failed or didn't return a valid HPKE configuration; or<a href="#section-4.2.1-6.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-6.3">the HPKE configuration specifies a KEM, KDF, or AEAD algorithm the client
doesn't recognize.<a href="#section-4.2.1-6.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.2.1-7">Aggregators <span class="bcp14">SHOULD</span> use HTTP caching to permit client-side caching of this
resource <span>[<a href="#RFC5861" class="xref">RFC5861</a>]</span>. Aggregators <span class="bcp14">SHOULD</span> favor long cache lifetimes to avoid
frequent cache revalidation, e.g., on the order of days. Aggregators can control
this cached lifetime with the Cache-Control header, as follows:<a href="#section-4.2.1-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2.1-8">
<pre>
  Cache-Control: max-age=86400
</pre><a href="#section-4.2.1-8" class="pilcrow">¶</a>
</div>
<p id="section-4.2.1-9">Clients <span class="bcp14">SHOULD</span> follow the usual HTTP caching <span>[<a href="#RFC7234" class="xref">RFC7234</a>]</span> semantics for key
configurations.<a href="#section-4.2.1-9" class="pilcrow">¶</a></p>
<p id="section-4.2.1-10">Note: Long cache lifetimes may result in clients using stale HPKE keys;
aggregators <span class="bcp14">SHOULD</span> continue to accept reports with old keys for at least twice
the cache lifetime in order to avoid rejecting reports.<a href="#section-4.2.1-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upload-request">
<section id="section-4.2.2">
          <h4 id="name-upload-request">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-upload-request" class="section-name selfRef">Upload Request</a>
          </h4>
<p id="section-4.2.2-1">Clients upload reports by using an HTTP POST to <code>[leader]/upload</code>, where
<code>[leader]</code> is the first entry in the task's aggregator endpoints. The payload is
structured as follows:<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2.2-2">
<pre>
struct {
  TaskID task_id;
  Nonce nonce;
  Extension extensions&lt;0..2^16-1&gt;;
  HpkeCiphertext encrypted_input_shares&lt;1..2^16-1&gt;;
} Report;
</pre><a href="#section-4.2.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.2.2-3">This message is called the client's <em>report</em>. It contains the following fields:<a href="#section-4.2.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2-4.1">
              <code>task_id</code> is the task ID of the task for which the report is intended.<a href="#section-4.2.2-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.2-4.2">
              <code>nonce</code> is the report nonce generated by the client. This field is used by the
aggregators to ensure the report appears in at most one batch. (See
<a href="#anti-replay" class="xref">Section 4.4.6</a>.)<a href="#section-4.2.2-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.2-4.3">
              <code>extensions</code> is a list of extensions to be included in the Upload flow; see
<a href="#upload-extensions" class="xref">Section 4.2.3</a>.<a href="#section-4.2.2-4.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.2-4.4">
              <code>encrypted_input_shares</code> contains the encrypted input shares of each of the
aggregators. The order in which the encrypted input shares appear <span class="bcp14">MUST</span> match
the order of the task's <code>aggregator_endpoints</code> (i.e., the first share should
be the leader's, the second share should be for the first helper, and so on).<a href="#section-4.2.2-4.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.2.2-5">To generate the report, the client begins by sharding its measurement into a
sequence of input shares as specified by the VDAF in use. To encrypt an input
share, the client generates an HPKE <span>[<a href="#RFC9180" class="xref">RFC9180</a>]</span> ciphertext and encapsulated
key for the aggregator by running<a href="#section-4.2.2-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2.2-6">
<pre>
enc, payload = SealBase(pk, "dap-01 input share" || 0x01 || server_role,
    task_id || nonce || extensions, input_share)
</pre><a href="#section-4.2.2-6" class="pilcrow">¶</a>
</div>
<p id="section-4.2.2-7">where <code>pk</code> is the aggregator's public key; <code>server_role</code> is the Role of the
intended recipient (<code>0x02</code> for the leader and <code>0x03</code> for the helper);
<code>task_id</code>, <code>nonce</code>, and <code>extensions</code> are the corresponding fields of <code>Report</code>;
and <code>input_share</code> is the aggregator's input share.<a href="#section-4.2.2-7" class="pilcrow">¶</a></p>
<p id="section-4.2.2-8">The leader responds to well-formed requests to <code>[leader]/upload</code> with HTTP status
code 200 OK and an empty body. Malformed requests are handled as described in <a href="#errors" class="xref">Section 3.1</a>.
Clients <span class="bcp14">SHOULD NOT</span> upload the same measurement value in more than one report if
the leader responds with HTTP status code 200 OK and an empty body.<a href="#section-4.2.2-8" class="pilcrow">¶</a></p>
<p id="section-4.2.2-9">The leader responds to requests whose leader encrypted input share uses an
out-of-date <code>HpkeConfig.id</code> value, indicated by <code>HpkeCiphertext.config_id</code>, with
HTTP status code 400 Bad Request and an error of type 'outdatedConfig'. Clients <span class="bcp14">SHOULD</span> invalidate any
cached aggregator <code>HpkeConfig</code> and retry with a freshly generated Report. If
this retried report does not succeed, clients <span class="bcp14">MUST</span> abort and discontinue
retrying.<a href="#section-4.2.2-9" class="pilcrow">¶</a></p>
<p id="section-4.2.2-10">The leader <span class="bcp14">MUST</span> ignore any report whose nonce contains a timestamp that falls in
a batch interval for which it has received at least one collect request from the
collector. (See <a href="#collect-flow" class="xref">Section 4.4</a>.) Otherwise, comparing the aggregate result to
the previous aggregate result may result in a privacy violation. (Note that the
helpers enforce this as well; see <a href="#collect-flow" class="xref">Section 4.4</a>.) In addition, the
leader <span class="bcp14">SHOULD</span> abort the upload protocol and alert the client with error
"reportTooLate".<a href="#section-4.2.2-10" class="pilcrow">¶</a></p>
<p id="section-4.2.2-11">Leaders can buffer reports while waiting to aggregate them. The leader <span class="bcp14">SHOULD NOT</span> accept reports whose timestamps are too far in the future. Implementors <span class="bcp14">MAY</span>
provide for some small leeway, usually no more than a few minutes, to account
for clock skew. If the leader rejects a report for this reason, it <span class="bcp14">SHOULD</span> abort
the upload protocol and alert the client with error "reportTooEarly".<a href="#section-4.2.2-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upload-extensions">
<section id="section-4.2.3">
          <h4 id="name-upload-extensions">
<a href="#section-4.2.3" class="section-number selfRef">4.2.3. </a><a href="#name-upload-extensions" class="section-name selfRef">Upload Extensions</a>
          </h4>
<p id="section-4.2.3-1">Each Report carries a list of extensions that clients may use to convey
additional, authenticated information in the report. [OPEN ISSUE: The extensions
aren't authenticated. It's probably a good idea to be a bit more clear about how
we envision extensions being used. Right now this includes client attestation
for defeating Sybil attacks. See issue#89.] Each extension is a tag-length
encoded value of the following form:<a href="#section-4.2.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2.3-2">
<pre>
  struct {
      ExtensionType extension_type;
      opaque extension_data&lt;0..2^16-1&gt;;
  } Extension;

  enum {
      TBD(0),
      (65535)
  } ExtensionType;
</pre><a href="#section-4.2.3-2" class="pilcrow">¶</a>
</div>
<p id="section-4.2.3-3">"extension_type" indicates the type of extension, and "extension_data" contains
information specific to the extension.<a href="#section-4.2.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="aggregate-flow">
<section id="section-4.3">
        <h3 id="name-verifying-and-aggregating-r">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-verifying-and-aggregating-r" class="section-name selfRef">Verifying and Aggregating Reports</a>
        </h3>
<p id="section-4.3-1">Once a set of clients have uploaded their reports to the leader, the leader can
send them to the helpers to be verified and aggregated. In order to enable the
system to handle very large batches of reports, this process can be performed
incrementally. Verification of a set of reports is referred to as an aggregation
job. Each aggregation job is associated with exactly one DAP task, and a DAP
task can have many aggregation jobs. Each job is associated with an ID that is
unique within the context of a DAP task in order to distinguish different jobs
from one another. Each aggregator uses this ID as an index into per-job storage,
e.g., to keep track of report shares that belong to a given aggregation job.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">To run an aggregation job, the leader sends a message to each helper containing
the report shares in the job. The helper then processes them (verifying the proofs
and incorporating their values into the ongoing aggregate) and replies to the leader.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">The exact structure of the aggregation job flow depends on the VDAF. Specifically:<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-4.1">Some VDAFs (e.g., Prio3) allow the leader to start aggregating reports
proactively before all the reports in a batch are received. Others (e.g.,
Poplar1) require all the reports to be present and must be initiated by the
collector.<a href="#section-4.3-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-4.2">Processing the reports -- especially validating them -- may require multiple
round trips.<a href="#section-4.3-4.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.3-5">Note that it is possible to aggregate reports from one batch while reports from
the next batch are coming in. This is because each report is validated independently.<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<p id="section-4.3-6">This process is illustrated below in <a href="#aggregation-flow-illustration" class="xref">Figure 2</a>. In this
example, the batch size is 20, but the leader opts to process the reports in
sub-batches of 10. Each sub-batch takes two round-trips to process.<a href="#section-4.3-6" class="pilcrow">¶</a></p>
<span id="name-aggregation-flow-batch-size"></span><div id="aggregation-flow-illustration">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-4.3-7.1">
<pre>
Leader                                                 Helper

Aggregate request (Reports 1-10, Job = N) ---------------&gt;  \
&lt;----------------------------- Aggregate response (Job = N) | Reports
Aggregate request (continued, Job = N) ------------------&gt;  | 1-10
&lt;----------------------------- Aggregate response (Job = N) /


Aggregate request (Reports 11-20, Job = M) --------------&gt;  \
&lt;----------------------------- Aggregate response (Job = M) | Reports
Aggregate request (continued, Job = M) ------------------&gt;  | 11-20
&lt;----------------------------- Aggregate response (Job = M) /
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-aggregation-flow-batch-size" class="selfRef">Aggregation Flow (batch size=20). Multiple aggregation flows can be executed at the same time.</a>
          </figcaption></figure>
</div>
<p id="section-4.3-8">[OPEN ISSUE: Should there be an indication of whether a given aggregate request is a
continuation of a previous sub-batch?]<a href="#section-4.3-8" class="pilcrow">¶</a></p>
<p id="section-4.3-9">The aggregation flow can be thought of as having three phases for transforming
each valid input report share into an output share:<a href="#section-4.3-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-10.1">Initialization: Begin the aggregation flow by sharing report shares with each
helper. Each aggregator, including the leader, initializates the underlying
VDAF instance using these report shares and the VDAF configured for the
corresponding measurement task.<a href="#section-4.3-10.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-10.2">Continuation: Continue the aggregation flow by exchanging messages produced
by the underlying VDAF instance until aggregation completes or an error occurs.
These messages do not replay the shares.<a href="#section-4.3-10.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-10.3">Completion: Finish the aggregate flow, yielding an output share corresponding
for each input report share in the batch.<a href="#section-4.3-10.3" class="pilcrow">¶</a>
</li>
        </ul>
<div id="agg-init">
<section id="section-4.3.1">
          <h4 id="name-aggregate-initialization">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-aggregate-initialization" class="section-name selfRef">Aggregate Initialization</a>
          </h4>
<p id="section-4.3.1-1">The leader begins an aggregation job by choosing a set of candidate reports that pertain
to the same DAP task and a unique job ID. The job ID is a 32-byte value, structured as follows:<a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1-2">
<pre>
opaque AggregationJobID[32];
</pre><a href="#section-4.3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1-3">The leader can run this process for many candidate reports in parallel as needed.
After choosing the set of candidates, the leader begins aggregation by splitting each
report into "report shares", one for each aggregator. The leader and helpers then run
the aggregate initialization flow to accomplish two tasks:<a href="#section-4.3.1-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.3.1-4">
<li id="section-4.3.1-4.1">Recover and determine which input report shares are invalid.<a href="#section-4.3.1-4.1" class="pilcrow">¶</a>
</li>
            <li id="section-4.3.1-4.2">For each valid report share, initialize the VDAF preparation process.<a href="#section-4.3.1-4.2" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-4.3.1-5">An invalid report share is marked with one of the following errors:<a href="#section-4.3.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1-6">
<pre>
enum {
  batch-collected(0),
  report-replayed(1),
  report-dropped(2),
  hpke-unknown-config-id(3),
  hpke-decrypt-error(4),
  vdaf-prep-error(5),
} ReportShareError;
</pre><a href="#section-4.3.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1-7">The leader and helper initialization behavior is detailed below.<a href="#section-4.3.1-7" class="pilcrow">¶</a></p>
<div id="leader-initialization">
<section id="section-4.3.1.1">
            <h5 id="name-leader-initialization">
<a href="#section-4.3.1.1" class="section-number selfRef">4.3.1.1. </a><a href="#name-leader-initialization" class="section-name selfRef">Leader Initialization</a>
            </h5>
<p id="section-4.3.1.1-1">The leader begins the aggregate initialization phase with the set of candidate report
shares as follows:<a href="#section-4.3.1.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.3.1.1-2">
<li id="section-4.3.1.1-2.1">Generate a fresh AggregationJobID. This ID <span class="bcp14">MUST</span> be unique within the context of the
corresponding DAP task. It is <span class="bcp14">RECOMMENDED</span> that this be set to a random string output
by a cryptographically secure pseudorandom number generator.<a href="#section-4.3.1.1-2.1" class="pilcrow">¶</a>
</li>
              <li id="section-4.3.1.1-2.2">Decrypt the input share for each report share as described in <a href="#input-share-decryption" class="xref">Section 4.3.1.3</a>.<a href="#section-4.3.1.1-2.2" class="pilcrow">¶</a>
</li>
              <li id="section-4.3.1.1-2.3">Check that the resulting input share is valid as described in <a href="#input-share-batch-validation" class="xref">Section 4.3.1.4</a>.<a href="#section-4.3.1.1-2.3" class="pilcrow">¶</a>
</li>
              <li id="section-4.3.1.1-2.4">Initialize VDAF preparation as described in <a href="#input-share-prep" class="xref">Section 4.3.1.5</a>.<a href="#section-4.3.1.1-2.4" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-4.3.1.1-3">If any step yields an invalid report share, the leader removes the report share from
the set of candidate reports. Once the leader has initialized this state for all valid
candidate report shares, it then creates an AggregateInitializeReq message for each helper to
initialize the preparation of this candidate set. The AggregateInitializeReq message is
structured as follows:<a href="#section-4.3.1.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.1-4">
<pre>
struct {
  Nonce nonce;
  Extension extensions&lt;0..2^16-1&gt;;
  HpkeCiphertext encrypted_input_share;
} ReportShare;

struct {
  TaskID task_id;
  AggregationJobID job_id;
  opaque agg_param&lt;0..2^16-1&gt;;
  ReportShare report_shares&lt;1..2^16-1&gt;;
} AggregateInitializeReq;
</pre><a href="#section-4.3.1.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1.1-5">[[OPEN ISSUE: consider sending report shares separately (in parallel) to the aggregate instructions. RIght now, aggregation parameters and the corresponding report shares are sent at the same time, but this may not be strictly necessary. ]]<a href="#section-4.3.1.1-5" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-6">The <code>nonce</code> and <code>extensions</code> fields of each ReportShare match that in the Report
uploaded by the client. The <code>encrypted_input_share</code> field is the <code>HpkeCiphertext</code>
whose index in <code>Report.encrypted_input_shares</code> is equal to the index of the aggregator
in the task's <code>aggregator_endpoints</code> to which the AggregateInitializeReq is being sent.
The <code>agg_param</code> field is an opaque, VDAF-specific aggregation parameter. The
<code>job_id</code> parameter contains the leader's chosen AggregationJobID.<a href="#section-4.3.1.1-6" class="pilcrow">¶</a></p>
<p id="section-4.3.1.1-7">Let <code>[aggregator]</code> denote the helper's API endpoint. The leader sends a POST
request to <code>[aggregator]/aggregate</code> with its AggregateInitializeReq message as
the payload. The media type is "message/dap-aggregate-initialize-req". In addition,
this request <span class="bcp14">MUST</span> be authenticated as described in <a href="#https-sender-auth" class="xref">Section 3.2</a>.<a href="#section-4.3.1.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="helper-initialization">
<section id="section-4.3.1.2">
            <h5 id="name-helper-initialization">
<a href="#section-4.3.1.2" class="section-number selfRef">4.3.1.2. </a><a href="#name-helper-initialization" class="section-name selfRef">Helper Initialization</a>
            </h5>
<p id="section-4.3.1.2-1">Each helper begins their portion of the aggregate initialization phase with the set
of candidate report shares obtained in an <code>AggregateInitializeReq</code> message from the leader.
It attempts to recover and validate the corresponding input shares similar to the leader,
and eventually returns a response to the leader carrying a VDAF-specific message for each
report share.<a href="#section-4.3.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.3.1.2-2">To begin this process, the helper first checks that the nonces in <code>AggregateInitializeReq.report_shares</code>
are all distinct. If two ReportShare values have the same nonce, then the helper <span class="bcp14">MUST</span> abort with
error "unrecognizedMessage". If this check succeeds, the helper then attempts to recover each
input share in <code>AggregateInitializeReq.report_shares</code> as follows:<a href="#section-4.3.1.2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.3.1.2-3">
<li id="section-4.3.1.2-3.1">Decrypt the input share for each report share as described in <a href="#input-share-decryption" class="xref">Section 4.3.1.3</a>.<a href="#section-4.3.1.2-3.1" class="pilcrow">¶</a>
</li>
              <li id="section-4.3.1.2-3.2">Check that the resulting input share is valid as described in <a href="#input-share-batch-validation" class="xref">Section 4.3.1.4</a>.<a href="#section-4.3.1.2-3.2" class="pilcrow">¶</a>
</li>
              <li id="section-4.3.1.2-3.3">Initialize VDAF preparation and initial outputs as described in <a href="#input-share-prep" class="xref">Section 4.3.1.5</a>.<a href="#section-4.3.1.2-3.3" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-4.3.1.2-4">[[OPEN ISSUE: consider moving the helper nonce check into #input-share-batch-validation]]<a href="#section-4.3.1.2-4" class="pilcrow">¶</a></p>
<p id="section-4.3.1.2-5">Once the helper has processed each valid report share in <code>AggregateInitializeReq.report_shares</code>, the
helper then creates an AggregateInitializeResp message to complete its initialization. This message is
structured as follows:<a href="#section-4.3.1.2-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.2-6">
<pre>
enum {
  continued(0),
  finished(1)
  failed(2),
} PrepareStepResult;

struct {
  Nonce nonce;
  PrepareStepResult prepare_step_result;
  select (PrepareStep.prepare_step_result) {
    case continued: opaque prep_msg&lt;0..2^16-1&gt;; // VDAF preparation message
    case finished:  Empty;
    case failed:    ReportShareError;
  }
} PrepareStep;

struct {
  AggregationJobID job_id;
  PrepareStep prepare_steps&lt;1..2^16-1&gt;;
} AggregateInitializeResp;
</pre><a href="#section-4.3.1.2-6" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1.2-7">The <code>job_id</code> parameter is equal to AggregateInitializeReq.job_id.
The rest of the message is a sequence of PrepareStep values, the order of which
matches that of the ReportShare values in <code>AggregateInitializeReq.report_shares</code>. Each report
that was marked as invalid is assigned the PrepareStepResult <code>failed</code>. Otherwise, the
PrepareStep is either marked as continued with the output <code>prep_msg</code>, or is marked
as finished if the VDAF preparation process is finished for the report share.<a href="#section-4.3.1.2-7" class="pilcrow">¶</a></p>
<p id="section-4.3.1.2-8">The helper's response to the leader is an HTTP status code 200 OK whose body is the
AggregateInitializeResp and media type is "message/dap-aggregate-initialize-resp".<a href="#section-4.3.1.2-8" class="pilcrow">¶</a></p>
<p id="section-4.3.1.2-9">Upon receipt of a helper's AggregateInitializeResp message, the leader checks that the
sequence of PrepareStep messages corresponds to the ReportShare sequence of the
AggregateInitializeReq. If any message appears out of order, is missing, has an
unrecognized nonce, or if two messages have the same nonce, then the leader <span class="bcp14">MUST</span>
abort with error "unrecognizedMessage".<a href="#section-4.3.1.2-9" class="pilcrow">¶</a></p>
<p id="section-4.3.1.2-10">[[OPEN ISSUE: the leader behavior here is sort of bizarre -- to whom does it abort?]]<a href="#section-4.3.1.2-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="input-share-decryption">
<section id="section-4.3.1.3">
            <h5 id="name-input-share-decryption">
<a href="#section-4.3.1.3" class="section-number selfRef">4.3.1.3. </a><a href="#name-input-share-decryption" class="section-name selfRef">Input Share Decryption</a>
            </h5>
<p id="section-4.3.1.3-1">Each report share has a corresponding task ID, nonce, list of extensions, and encrypted
input share. Let <code>task_id</code>, <code>nonce</code>, <code>extensions</code>, and <code>encrypted_input_share</code> denote these
values, respectively. Given these values, an aggregator decrypts the input
share as follows. First, the aggregator looks up the HPKE config and corresponding
secret key indicated by <code>encrypted_input_share.config_id</code>. If not found, then it
marks the report share as invalid with the error <code>hpke-unknown-config-id</code>.
Otherwise, it decrypts the payload with the following procedure:<a href="#section-4.3.1.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.3-2">
<pre>
input_share = OpenBase(encrypted_input_share.enc, sk, "dap-01 input share" ||
    0x01 || server_role, task_id || nonce || extensions,
    encrypted_input_share.payload)
</pre><a href="#section-4.3.1.3-2" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1.3-3">where <code>sk</code> is the HPKE secret key, and <code>server_role</code> is the role of the
aggregator (<code>0x02</code> for the leader and <code>0x03</code> for the helper). If decryption
fails, the aggregator marks the report share as invalid with the error
<code>hpke-decrypt-error</code>. Otherwise, it outputs the resulting <code>input_share</code>.<a href="#section-4.3.1.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="input-share-batch-validation">
<section id="section-4.3.1.4">
            <h5 id="name-input-share-validation">
<a href="#section-4.3.1.4" class="section-number selfRef">4.3.1.4. </a><a href="#name-input-share-validation" class="section-name selfRef">Input Share Validation</a>
            </h5>
<p id="section-4.3.1.4-1">Validating an input share will either succeed or fail. In the case of failure,
the input share is marked as invalid with a corresponding ReportShareError error.<a href="#section-4.3.1.4-1" class="pilcrow">¶</a></p>
<p id="section-4.3.1.4-2">The validation checks are as follows.<a href="#section-4.3.1.4-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.3.1.4-3">
<li id="section-4.3.1.4-3.1">Check if the report has never been aggregated but is contained by
a batch that has been collected. If this check fails, the input share
is marked as invalid with the error <code>batch-collected</code>. This prevents
additional reports from being aggregated after its batch has already
been collected.<a href="#section-4.3.1.4-3.1" class="pilcrow">¶</a>
</li>
              <li id="section-4.3.1.4-3.2">Check if the report has already been aggregated. If this check fails,
the input share is marked as invalid with the error <code>report-replayed</code>.
This is the case if the report was used in a previous aggregate request
and is therefore a replay. An aggregator may also choose to mark an
input share as invalid with the  error <code>report-dropped</code> under the conditions
prescribed in <a href="#anti-replay" class="xref">Section 4.4.6</a>.<a href="#section-4.3.1.4-3.2" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-4.3.1.4-4">If both checks succeed, the input share is not marked as invalid.<a href="#section-4.3.1.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="input-share-prep">
<section id="section-4.3.1.5">
            <h5 id="name-input-share-preparation">
<a href="#section-4.3.1.5" class="section-number selfRef">4.3.1.5. </a><a href="#name-input-share-preparation" class="section-name selfRef">Input Share Preparation</a>
            </h5>
<p id="section-4.3.1.5-1">Input share preparation consists of running the preparation-state initialization
algorithm for the VDAF associated with the task and computes the first state transition.
This produces three possible values:<a href="#section-4.3.1.5-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.3.1.5-2">
<li id="section-4.3.1.5-2.1">An error, in which case the input report share is marked as invalid.<a href="#section-4.3.1.5-2.1" class="pilcrow">¶</a>
</li>
              <li id="section-4.3.1.5-2.2">An output share, in which case the aggregator stores the output share for future collection
as described in <a href="#collect-flow" class="xref">Section 4.4</a>.<a href="#section-4.3.1.5-2.2" class="pilcrow">¶</a>
</li>
              <li id="section-4.3.1.5-2.3">An initial VDAF state and preparation message, denoted <code>(prep_state, prep_msg)</code>.<a href="#section-4.3.1.5-2.3" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-4.3.1.5-3">Each aggregator runs this procedure for a given input share with corresponding nonce
as follows:<a href="#section-4.3.1.5-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1.5-4">
<pre>
prep_state = VDAF.prep_init(vdaf_verify_param, agg_param, nonce, input_share)
out = VDAF.prep_next(prep_state, None)
</pre><a href="#section-4.3.1.5-4" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1.5-5"><code>vdaf_verify_param</code> is the public VDAF parameter, and <code>agg_param</code> is the opaque aggregation
parameter. If either step fails, the aggregator marks the report as invalid with error
<code>vdaf-prep-error</code>.<a href="#section-4.3.1.5-5" class="pilcrow">¶</a></p>
<p id="section-4.3.1.5-6">Otherwise, the value <code>out</code> is interpreted as follows. If this is the last round of the VDAF,
then <code>out</code> is the aggregator's output share. Otherwise, <code>out</code> is the pair <code>(prep_state, prep_msg)</code>.<a href="#section-4.3.1.5-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="agg-continue-flow">
<section id="section-4.3.2">
          <h4 id="name-aggregate-continuation">
<a href="#section-4.3.2" class="section-number selfRef">4.3.2. </a><a href="#name-aggregate-continuation" class="section-name selfRef">Aggregate Continuation</a>
          </h4>
<p id="section-4.3.2-1">In the continuation phase, the leader drives the VDAF preparation of each share in the
candidate report set until the underlying VDAF moves into a terminal state, yielding
an output share for all aggregators or an error. This phase may involve multiple rounds
of interaction depending on the underlying VDAF parameters. Each round trip is initiated
by the leader.<a href="#section-4.3.2-1" class="pilcrow">¶</a></p>
<div id="leader-continuation">
<section id="section-4.3.2.1">
            <h5 id="name-leader-continuation">
<a href="#section-4.3.2.1" class="section-number selfRef">4.3.2.1. </a><a href="#name-leader-continuation" class="section-name selfRef">Leader Continuation</a>
            </h5>
<p id="section-4.3.2.1-1">The leader begins each round of continuation for a report share based on its locally computed
prepare message and the previous PrepareStep from the helper. If PrepareStep is of type "failed",
then the leader marks the report as failed and removes it from the candidate report set and does not
process it further. If the type is "finished", then the leader aborts with "unrecognizedMessage".
[[OPEN ISSUE: This behavior is not specified.]] If the type is "continued", then the leader proceeds as
follows.<a href="#section-4.3.2.1-1" class="pilcrow">¶</a></p>
<p id="section-4.3.2.1-2">Let <code>leader_outbound</code> denote the leader's prepare message and <code>helper_outbound</code> denote the
helper's. The leader computes the next state transition as follows:<a href="#section-4.3.2.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.2.1-3">
<pre>
inbound = VDAF.prep_shares_to_prep(agg_param, [leader_outbound, helper_outbound])
out = VDAF.prep_next(prep_state, inbound)
</pre><a href="#section-4.3.2.1-3" class="pilcrow">¶</a>
</div>
<p id="section-4.3.2.1-4">where [leader_outbound, helper_outbound] is a vector of two elements.
If either of these operations fails, then the leader marks the report as invalid.
Otherwise it interprets <code>out</code> as follows. If this is the last round of the VDAF,
then <code>out</code> is the aggregator's output share, in which case the aggregator finishes
and stores its output share for further processing as described in <a href="#collect-flow" class="xref">Section 4.4</a>.
Otherwise, <code>out</code> is the pair <code>(new_state, prep_msg)</code>, where <code>new_state</code> is its updated
state and <code>prep_msg</code> is its next VDAF message (which will be <code>leader_outbound</code> in the next
round of continuation). For the latter case, the helper sets <code>prep_state</code> to <code>new_state</code>.<a href="#section-4.3.2.1-4" class="pilcrow">¶</a></p>
<p id="section-4.3.2.1-5">The leader then sends each PrepareStep to the helper in an AggregateContinueReq message,
structured as follows:<a href="#section-4.3.2.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.2.1-6">
<pre>
struct {
  AggregationJobID job_id;
  PrepareStep prepare_shares&lt;1..2^16-1&gt;;
} AggregateContinueReq;
</pre><a href="#section-4.3.2.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.3.2.1-7">For each aggregator endpoint <code>[aggregator]</code> in <code>AggregateContinueReq.task_id</code>'s
parameters except its own, the leader sends a POST request to
<code>[aggregator]/aggregate</code> with AggregateContinueReq as the payload and the media
type set to "message/dap-aggregate-continue-req". In addition, this request <span class="bcp14">MUST</span>
be authenticated as described in <a href="#https-sender-auth" class="xref">Section 3.2</a>.<a href="#section-4.3.2.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="helper-continuation">
<section id="section-4.3.2.2">
            <h5 id="name-helper-continuation">
<a href="#section-4.3.2.2" class="section-number selfRef">4.3.2.2. </a><a href="#name-helper-continuation" class="section-name selfRef">Helper Continuation</a>
            </h5>
<p id="section-4.3.2.2-1">The helper continues with preparation for a report share by combining the leader's input
message in <code>AggregateContinueReq</code> and its current preparation state (<code>prep_state</code>). This
step yields one of three outputs:<a href="#section-4.3.2.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.3.2.2-2">
<li id="section-4.3.2.2-2.1">An error, in which case the input report share is marked as invalid.<a href="#section-4.3.2.2-2.1" class="pilcrow">¶</a>
</li>
              <li id="section-4.3.2.2-2.2">An output share, in which case the helper stores the output share for future collection
as described in <a href="#collect-flow" class="xref">Section 4.4</a>.<a href="#section-4.3.2.2-2.2" class="pilcrow">¶</a>
</li>
              <li id="section-4.3.2.2-2.3">An updated VDAF state and preparation message, denoted <code>(prep_state, prep_msg)</code>.<a href="#section-4.3.2.2-2.3" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-4.3.2.2-3">To carry out this step, for each PrepareStep in AggregateContinueReq.prepare_shares received
from the leader, the helper performs the following check to determine if the report share
should continue being prepared.<a href="#section-4.3.2.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.2.2-4.1">If failed, then mark the report as failed and reply with a failed PrepareStep
to the leader.<a href="#section-4.3.2.2-4.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.3.2.2-4.2">If finished, then mark the report as finished and reply with a finished PrepareStep
to the leader. The helper then stores the output share and awaits for collection;
see <a href="#collect-flow" class="xref">Section 4.4</a>.<a href="#section-4.3.2.2-4.2" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-4.3.2.2-5">Otherwise, preparation continues. In this case, the helper computes its updated state
and output message as follows:<a href="#section-4.3.2.2-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.2.2-6">
<pre>
out = VDAF.prep_next(prep_state, inbound)
</pre><a href="#section-4.3.2.2-6" class="pilcrow">¶</a>
</div>
<p id="section-4.3.2.2-7">where <code>inbound</code> is the previous VDAF preapre message sent by the leader and <code>prep_state</code> is
the helper's current preparation state. If this operation fails, then the helper fails
with error <code>vdaf-prep-error</code>. Otherwise, it interprets <code>out</code> as follows. If this
is the last round of VDAF preparation phase, then <code>out</code> is the helper's output
share, in which case the helper stores the output share for future collection.
Otherwise, the helper interpets <code>out</code> as the tuple <code>(new_state, prep_msg)</code>, where
<code>new_state</code> is its updated preparation state and <code>prep_msg</code> is its next VDAF
message.<a href="#section-4.3.2.2-7" class="pilcrow">¶</a></p>
<p id="section-4.3.2.2-8">This output message for each report in AggregateContinueReq.prepare_shares is then sent
to the leader in an AggregateContinueResp message, structured as follows:<a href="#section-4.3.2.2-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.2.2-9">
<pre>
struct {
  AggregationJobID job_id;
  PrepareStep prepare_shares&lt;1..2^16-1&gt;;
} AggregateContinueResp;
</pre><a href="#section-4.3.2.2-9" class="pilcrow">¶</a>
</div>
<p id="section-4.3.2.2-10">The order of AggregateContinueResp.prepare_shares <span class="bcp14">MUST</span> match that of the PrepareStep values in
<code>AggregateContinueReq.prepare_shares</code>. The helper's response to the leader is an HTTP status code
200 OK whose body is the AggregateContinueResp and media type is "message/dap-aggregate-continue-resp".
The helper then awaits the next message from the leader.<a href="#section-4.3.2.2-10" class="pilcrow">¶</a></p>
<p id="section-4.3.2.2-11">[[OPEN ISSUE: consider relaxing this ordering constraint. See issue#217.]]<a href="#section-4.3.2.2-11" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="collect-flow">
<section id="section-4.4">
        <h3 id="name-collecting-results">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-collecting-results" class="section-name selfRef">Collecting Results</a>
        </h3>
<p id="section-4.4-1">In this phase, the collector requests aggregate shares from each aggregator
and then locally combines them to yield a single, aggregate output. In particular,
the collector asks the leader to collect and return the results for a given
DAP task over a given time period. The aggregate shares are encrypted to the
collector so that it can decrypt and combine them to yield the aggregate output.
This entire process is composed of two interactions:<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.4-2">
<li id="section-4.4-2.1">Collect request and response between the collector and leader, specified
in <a href="#collect-init" class="xref">Section 4.4.1</a><a href="#section-4.4-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-4.4-2.2">Aggregate share request and response between the leader and each aggregator,
specified in <a href="#collect-aggregate" class="xref">Section 4.4.2</a><a href="#section-4.4-2.2" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-4.4-3">Once complete, the collector computes the final aggregate result as specified in
<a href="#collect-finalization" class="xref">Section 4.4.3</a>.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<div id="collect-init">
<section id="section-4.4.1">
          <h4 id="name-collection-initialization">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-collection-initialization" class="section-name selfRef">Collection Initialization</a>
          </h4>
<p id="section-4.4.1-1">To initiate collection, the collector issues a POST request to <code>[leader]/collect</code>,
where <code>[leader]</code> is the leader's endpoint URL. The request <span class="bcp14">MUST</span> be authenticated
as described in <a href="#https-sender-auth" class="xref">Section 3.2</a>. The body of the request is structured as
follows:<a href="#section-4.4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.4.1-2">[OPEN ISSUE: Decide if and how the collector's request is authenticated. If not,
then we need to ensure that collect job URIs are resistant to enumeration
attacks.]<a href="#section-4.4.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1-3">
<pre>
struct {
  TaskID task_id;
  Interval batch_interval;
  opaque agg_param&lt;0..2^16-1&gt;; // VDAF aggregation parameter
} CollectReq;
</pre><a href="#section-4.4.1-3" class="pilcrow">¶</a>
</div>
<p id="section-4.4.1-4">The named parameters are:<a href="#section-4.4.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1-5.1">
              <code>task_id</code>, the DAP task ID.<a href="#section-4.4.1-5.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.1-5.2">
              <code>batch_interval</code>, the request's batch interval.<a href="#section-4.4.1-5.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.1-5.3">
              <code>agg_param</code>, an aggregation parameter for the VDAF being executed.<a href="#section-4.4.1-5.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.4.1-6">Depending on the VDAF scheme and how the leader is configured, the leader and
helper may already have prepared all the reports falling within <code>batch_interval</code>
and be ready to return the aggregate shares right away, but this cannot be
guaranteed. In fact, for some VDAFs, it is not be possible to begin preparing
inputs until the collector provides the aggregation parameter in the
<code>CollectReq</code>. For these reasons, collect requests are handled asynchronously.<a href="#section-4.4.1-6" class="pilcrow">¶</a></p>
<p id="section-4.4.1-7">Upon receipt of a <code>CollectReq</code>, the leader begins by checking that the request
meets the requirements of the batch parameters using the procedure in
<a href="#batch-parameter-validation" class="xref">Section 4.4.5</a>. If so, it immediately sends the collector a
response with HTTP status 303 See Other and a Location header containing a URI
identifying the collect job that can be polled by the collector, called the
"collect job URI".<a href="#section-4.4.1-7" class="pilcrow">¶</a></p>
<p id="section-4.4.1-8">The leader then begins working with the helper to prepare the shares falling
into <code>CollectReq.batch_interval</code> (or continues this process, depending on the
VDAF) as described in <a href="#aggregate-flow" class="xref">Section 4.3</a>.<a href="#section-4.4.1-8" class="pilcrow">¶</a></p>
<p id="section-4.4.1-9">After receiving the response to its CollectReq, the collector makes an HTTP GET
request to the collect job URI to check on the status of the collect job and
eventually obtain the result. If the collect job is not finished yet, the leader
responds with HTTP status 202 Accepted. The response <span class="bcp14">MAY</span> include a Retry-After
header field to suggest a pulling interval to the collector.<a href="#section-4.4.1-9" class="pilcrow">¶</a></p>
<p id="section-4.4.1-10">If the leader has not yet obtained an aggregator share from each aggregator,
the leader invokes the aggregate share request flow described in <a href="#collect-aggregate" class="xref">Section 4.4.2</a>.
Otherwise, when all aggregator shares are successfully obtained, the leader responds
to subsequent HTTP GET requests to the collect job's URI with HTTP status code 200 OK
and a body consisting of a <code>CollectResp</code>:<a href="#section-4.4.1-10" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1-11">
<pre>
struct {
  HpkeCiphertext encrypted_agg_shares&lt;1..2^16-1&gt;;
} CollectResp;
</pre><a href="#section-4.4.1-11" class="pilcrow">¶</a>
</div>
<p id="section-4.4.1-12">The <code>encrypted_agg_shares</code> field is the vector of encrypted aggregate shares.
They <span class="bcp14">MUST</span> appear in the same order as the aggregator endpoints list of the task
parameters.<a href="#section-4.4.1-12" class="pilcrow">¶</a></p>
<p id="section-4.4.1-13">If obtaining aggregate shares fails, then the leader responds to subsequent HTTP
GET requests to the collect job URI with an HTTP error status and a problem
document as described in <a href="#errors" class="xref">Section 3.1</a>.<a href="#section-4.4.1-13" class="pilcrow">¶</a></p>
<p id="section-4.4.1-14">The leader <span class="bcp14">MUST</span> retain a collect job's results until the collector sends an HTTP
DELETE request to the collect job URI, in which case the leader responds with
HTTP status 204 No Content.<a href="#section-4.4.1-14" class="pilcrow">¶</a></p>
<p id="section-4.4.1-15">[OPEN ISSUE: Allow the leader to drop aggregate shares after some reasonable
amount of time has passed, but it's not clear how to specify that. ACME doesn't
bother to say anything at all about this when describing how subscribers should
fetch certificates: https://datatracker.ietf.org/doc/html/rfc8555#section-7.4.2]<a href="#section-4.4.1-15" class="pilcrow">¶</a></p>
<p id="section-4.4.1-16">[OPEN ISSUE: Describe how intra-protocol errors yield collect errors (see
issue#57). For example, how does a leader respond to a collect request if the
helper drops out?]<a href="#section-4.4.1-16" class="pilcrow">¶</a></p>
</section>
</div>
<div id="collect-aggregate">
<section id="section-4.4.2">
          <h4 id="name-collection-aggregation">
<a href="#section-4.4.2" class="section-number selfRef">4.4.2. </a><a href="#name-collection-aggregation" class="section-name selfRef">Collection Aggregation</a>
          </h4>
<p id="section-4.4.2-1">The leader obtains each helper's encrypted aggregate share in order to respond
to the collector's collect response. To do this, the leader first computes a
checksum over the set of output shares included in the batch window identified
by the collect request. The checksum is computed by taking the SHA256 hash of
each nonce from the client reports included in the aggregation, then combining
the hash values with a bitwise-XOR operation.<a href="#section-4.4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.4.2-2">Then, for each aggregator endpoint <code>[aggregator]</code> in the parameters associated
with <code>CollectReq.task_id</code> (see <a href="#collect-flow" class="xref">Section 4.4</a>) except its own, the leader sends
a POST request to <code>[aggregator]/aggregate_share</code> with the following message:<a href="#section-4.4.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.2-3">
<pre>
struct {
  TaskID task_id;
  Interval batch_interval;
  opaque agg_param&lt;0..2^16-1&gt;;
  uint64 report_count;
  opaque checksum[32];
} AggregateShareReq;
</pre><a href="#section-4.4.2-3" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-4.4.2-4.1">
              <code>task_id</code> is the task ID associated with the DAP parameters.<a href="#section-4.4.2-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.2-4.2">
              <code>batch_interval</code> is the batch interval of the request.<a href="#section-4.4.2-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.2-4.3">
              <code>agg_param</code>, an aggregation parameter for the VDAF being executed.<a href="#section-4.4.2-4.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.2-4.4">
              <code>report_count</code> is the number of reports included in the aggregation.<a href="#section-4.4.2-4.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.2-4.5">
              <code>checksum</code> is the checksum computed over the set of client reports.<a href="#section-4.4.2-4.5" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.4.2-5">This request <span class="bcp14">MUST</span> be authenticated as described in <a href="#https-sender-auth" class="xref">Section 3.2</a>. To
handle the leader's request, the helper first ensures that the request meets the
requirements for batch parameters following the procedure in
<a href="#batch-parameter-validation" class="xref">Section 4.4.5</a>.<a href="#section-4.4.2-5" class="pilcrow">¶</a></p>
<p id="section-4.4.2-6">Next, it computes a checksum based on its view of the output shares included in
the batch window, and checks that the <code>report_count</code> and <code>checksum</code> included in
the request match its computed values. If not, then it <span class="bcp14">MUST</span> abort with error
"batchMismatch".<a href="#section-4.4.2-6" class="pilcrow">¶</a></p>
<p id="section-4.4.2-7">Next, it computes the aggregate share <code>agg_share</code> corresponding to the set of
output shares, denoted <code>out_shares</code>, for the batch interval, as follows:<a href="#section-4.4.2-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.2-8">
<pre>
agg_share = VDAF.out_shares_to_agg_share(agg_param, out_shares)
</pre><a href="#section-4.4.2-8" class="pilcrow">¶</a>
</div>
<p id="section-4.4.2-9">Note that for most VDAFs, it is possible to aggregate output shares as they
arrive rather than wait until the batch is collected. To do so however, it is
necessary to enforce the batch parameters as described in
<a href="#batch-parameter-validation" class="xref">Section 4.4.5</a> so that the aggregator knows which aggregate
share to update.<a href="#section-4.4.2-9" class="pilcrow">¶</a></p>
<p id="section-4.4.2-10">The helper then encrypts <code>agg_share</code> under the collector's HPKE public
key as described in <a href="#aggregate-share-encrypt" class="xref">Section 4.4.4</a>, yielding <code>encrypted_agg_share</code>.
Encryption prevents the leader from learning the actual result, as it only has
its own aggregate share and cannot compute the helper's.<a href="#section-4.4.2-10" class="pilcrow">¶</a></p>
<p id="section-4.4.2-11">The helper responds to the leader with HTTP status code 200 OK and a body consisting
of an <code>AggregateShareResp</code>:<a href="#section-4.4.2-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.2-12">
<pre>
struct {
    HpkeCiphertext encrypted_aggregate_share;
} AggregateShareResp;
</pre><a href="#section-4.4.2-12" class="pilcrow">¶</a>
</div>
<p id="section-4.4.2-13"><code>encrypted_aggregate_share.config_id</code> is set to the collector's HPKE config ID.
<code>encrypted_aggregate_share.enc</code> is set to the encapsulated HPKE context <code>enc</code>
computed above and <code>encrypted_aggregate_share.ciphertext</code> is the ciphertext
<code>encrypted_agg_share</code> computed above.<a href="#section-4.4.2-13" class="pilcrow">¶</a></p>
<p id="section-4.4.2-14">After receiving the helper's response, the leader uses the HpkeCiphertext to
respond to a collect request (see <a href="#collect-flow" class="xref">Section 4.4</a>).<a href="#section-4.4.2-14" class="pilcrow">¶</a></p>
<p id="section-4.4.2-15">After issuing an aggregate-share request for a given batch interval, it is an
error for the leader to issue any more aggregate or aggregate-init requests for
additional reports in the batch interval. These reports will be rejected by helpers as
described <a href="#agg-init" class="xref">Section 4.3.1</a>.<a href="#section-4.4.2-15" class="pilcrow">¶</a></p>
<p id="section-4.4.2-16">Before completing the collect request, the leader also computes its own aggregate
share <code>agg_share</code> by aggregating all of the prepared output shares that fall within
the batch interval. Finally, it encrypts it under the collector's HPKE public key as
described in <a href="#aggregate-share-encrypt" class="xref">Section 4.4.4</a>.<a href="#section-4.4.2-16" class="pilcrow">¶</a></p>
</section>
</div>
<div id="collect-finalization">
<section id="section-4.4.3">
          <h4 id="name-collection-finalization">
<a href="#section-4.4.3" class="section-number selfRef">4.4.3. </a><a href="#name-collection-finalization" class="section-name selfRef">Collection Finalization</a>
          </h4>
<p id="section-4.4.3-1">Once the collector has received a successful collect response from the leader,
it can decrypt the aggregate shares and produce an aggregate result. The collector
decrypts each aggregate share as described in <a href="#aggregate-share-encrypt" class="xref">Section 4.4.4</a>.
If the collector successfully decrypts all aggregate shares, the collector
then unshards the aggregate shares into an aggregate result using the VDAF's
<code>agg_shares_to_result</code> algorithm. In particular, let <code>agg_shares</code> denote the
ordered sequence of aggregator shares, ordered by aggregator index, and let
<code>agg_param</code> be the opaque aggregation parameter. The final aggregate result
is computed as follows:<a href="#section-4.4.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.3-2">
<pre>
agg_result = VDAF.agg_shares_to_result(agg_param, agg_shares)
</pre><a href="#section-4.4.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="aggregate-share-encrypt">
<section id="section-4.4.4">
          <h4 id="name-aggregate-share-encryption">
<a href="#section-4.4.4" class="section-number selfRef">4.4.4. </a><a href="#name-aggregate-share-encryption" class="section-name selfRef">Aggregate Share Encryption</a>
          </h4>
<p id="section-4.4.4-1">Encrypting an aggregate share <code>agg_share</code> for a given <code>AggregateShareReq</code> is done
as follows:<a href="#section-4.4.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.4-2">
<pre>
enc, payload = SealBase(pk, "dap-01 aggregate share" || server_role || 0x00,
  AggregateShareReq.task_id || AggregateShareReq.batch_interval, agg_share)
</pre><a href="#section-4.4.4-2" class="pilcrow">¶</a>
</div>
<p id="section-4.4.4-3">where <code>pk</code> is the HPKE public key encoded by the collector's HPKE key,
<code>server_role</code> is <code>0x02</code> for the leader and <code>0x03</code> for a helper.<a href="#section-4.4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4.4-4">The collector decrypts these aggregate shares using the opposite process.
Specifically, given an encrypted input share, denoted <code>enc_share</code>, for a
given batch interval, denoted <code>batch_interval</code>, decryption works as follows:<a href="#section-4.4.4-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.4-5">
<pre>
agg_share = OpenBase(enc_share.enc, sk, "dap-01 aggregate share" ||
    server_role || 0x00, task_id || batch_interval, enc_share.payload)
</pre><a href="#section-4.4.4-5" class="pilcrow">¶</a>
</div>
<p id="section-4.4.4-6">where <code>sk</code> is the HPKE secret key, <code>task_id</code> is the task ID for the collect
request, and <code>server_role</code> is the role of the server that sent the aggregate
share (<code>0x02</code> for the leader and <code>0x03</code> for the helper).<a href="#section-4.4.4-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="batch-parameter-validation">
<section id="section-4.4.5">
          <h4 id="name-validating-batch-parameters">
<a href="#section-4.4.5" class="section-number selfRef">4.4.5. </a><a href="#name-validating-batch-parameters" class="section-name selfRef">Validating Batch Parameters</a>
          </h4>
<p id="section-4.4.5-1">Before an aggregator responds to a collect request or aggregate-share request,
it must first check that the request does not violate the parameters associated
with the DAP task. It does so as described here.<a href="#section-4.4.5-1" class="pilcrow">¶</a></p>
<p id="section-4.4.5-2">First the aggregator checks that the request's batch interval respects the
boundaries defined by the DAP task's parameters. Namely, it checks that both
<code>batch_interval.start</code> and <code>batch_interval.duration</code> are divisible by
<code>min_batch_duration</code> and that <code>batch_interval.duration &gt;= min_batch_duration</code>.
Unless both these conditions are true, the aggregator <span class="bcp14">MUST</span> abort and alert its
peer with error "batchInvalid".<a href="#section-4.4.5-2" class="pilcrow">¶</a></p>
<p id="section-4.4.5-3">Next, the aggregator checks that the request respects the generic privacy
parameters of the DAP task. Let <code>X</code> denote the set of reports for which the
aggregator has recovered a valid output share and which fall in the batch
interval of the request.<a href="#section-4.4.5-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.5-4.1">If <code>len(X) &lt; min_batch_size</code>, then the aggregator <span class="bcp14">MUST</span> abort and alert its
peer with "insufficientBatchSize".<a href="#section-4.4.5-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.4.5-4.2">The aggregator keeps track of the number of times each report was added to the
batch of an AggregateShareReq. If any report in <code>X</code> was added to at least
<code>max_batch_lifetime</code> previous batches, then the aggregator <span class="bcp14">MUST</span> abort and
alert the peer with "batchLifetimeExceeded".<a href="#section-4.4.5-4.2" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="anti-replay">
<section id="section-4.4.6">
          <h4 id="name-anti-replay">
<a href="#section-4.4.6" class="section-number selfRef">4.4.6. </a><a href="#name-anti-replay" class="section-name selfRef">Anti-replay</a>
          </h4>
<p id="section-4.4.6-1">Using a client-provided report multiple times within a single batch, or using
the same report in multiple batches, may allow a server to learn information
about the client's measurement, violating the privacy goal of DAP. To
prevent such replay attacks, this specification requires the aggregators to
detect and filter out replayed reports.<a href="#section-4.4.6-1" class="pilcrow">¶</a></p>
<p id="section-4.4.6-2">To detect replay attacks, each aggregator keeps track of the set of nonces
pertaining to reports that were previously aggregated for a given task. If the
leader receives a report from a client whose nonce is in this set, it simply
ignores it. A helper who receives an encrypted input share whose nonce is
in this set replies to the leader with an error as described in
<a href="#input-share-batch-validation" class="xref">Section 4.3.1.4</a>.<a href="#section-4.4.6-2" class="pilcrow">¶</a></p>
<p id="section-4.4.6-3">[OPEN ISSUE: This has the potential to require aggreagtors to store nonce sests
indefinitely. See issue#180.]<a href="#section-4.4.6-3" class="pilcrow">¶</a></p>
<p id="section-4.4.6-4">A malicious aggregator may attempt to force a replay by replacing the nonce
generated by the client with a nonce its peer has not yet seen. To prevent this,
clients incorporate the nonce into the AAD for HPKE encryption, ensuring that
the output share is only recovered if the aggregator is given the correct nonce.
(See <a href="#upload-request" class="xref">Section 4.2.2</a>.)<a href="#section-4.4.6-4" class="pilcrow">¶</a></p>
<p id="section-4.4.6-5">Aggregators prevent the same report from being used in multiple batches (except
as required by the protocol) by only responding to valid collect requests, as
described in <a href="#batch-parameter-validation" class="xref">Section 4.4.5</a>.<a href="#section-4.4.6-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="operational-capabilities">
<section id="section-5">
      <h2 id="name-operational-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-operational-considerations" class="section-name selfRef">Operational Considerations</a>
      </h2>
<p id="section-5-1">The DAP protocol has inherent constraints derived from the tradeoff between
privacy guarantees and computational complexity. These tradeoffs influence how
applications may choose to utilize services implementing the specification.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="entity-capabilities">
<section id="section-5.1">
        <h3 id="name-protocol-participant-capabi">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-protocol-participant-capabi" class="section-name selfRef">Protocol participant capabilities</a>
        </h3>
<p id="section-5.1-1">The design in this document has different assumptions and requirements for
different protocol participants, including clients, aggregators, and collectors.
This section describes these capabilities in more detail.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<div id="client-capabilities">
<section id="section-5.1.1">
          <h4 id="name-client-capabilities">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-client-capabilities" class="section-name selfRef">Client capabilities</a>
          </h4>
<p id="section-5.1.1-1">Clients have limited capabilities and requirements. Their only inputs to the
protocol are (1) the parameters configured out of band and (2) a measurement.
Clients are not expected to store any state across any upload flows, nor are
they required to implement any sort of report upload retry mechanism. By
design, the protocol in this document is robust against individual client upload
failures since the protocol output is an aggregate over all inputs.<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregator-capabilities">
<section id="section-5.1.2">
          <h4 id="name-aggregator-capabilities">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-aggregator-capabilities" class="section-name selfRef">Aggregator capabilities</a>
          </h4>
<p id="section-5.1.2-1">Helpers and leaders have different operational requirements. The design in this
document assumes an operationally competent leader, i.e., one that has no
storage or computation limitations or constraints, but only a modestly
provisioned helper, i.e., one that has computation, bandwidth, and storage
constraints. By design, leaders must be at least as capable as helpers, where
helpers are generally required to:<a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.2-2.1">Support the collect protocol, which includes validating and aggregating
reports; and<a href="#section-5.1.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.1.2-2.2">Publish and manage an HPKE configuration that can be used for the upload
protocol.<a href="#section-5.1.2-2.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.1.2-3">In addition, for each DAP task, helpers are required to:<a href="#section-5.1.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.2-4.1">Implement some form of batch-to-report index, as well as inter- and
intra-batch replay mitigation storage, which includes some way of tracking
batch report size. Some of this state may be used for replay attack
mitigation. The replay mitigation strategy is described in <a href="#anti-replay" class="xref">Section 4.4.6</a>.<a href="#section-5.1.2-4.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.1.2-5">Beyond the minimal capabilities required of helpers, leaders are generally
required to:<a href="#section-5.1.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.2-6.1">Support the upload protocol and store reports; and<a href="#section-5.1.2-6.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.1.2-6.2">Track batch report size during each collect flow and request encrypted output
shares from helpers.<a href="#section-5.1.2-6.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.1.2-7">In addition, for each DAP task, leaders are required to:<a href="#section-5.1.2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.2-8.1">Implement and store state for the form of inter- and intra-batch replay
mitigation in <a href="#anti-replay" class="xref">Section 4.4.6</a>; and<a href="#section-5.1.2-8.1" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="collector-capabilities">
<section id="section-5.1.3">
          <h4 id="name-collector-capabilities">
<a href="#section-5.1.3" class="section-number selfRef">5.1.3. </a><a href="#name-collector-capabilities" class="section-name selfRef">Collector capabilities</a>
          </h4>
<p id="section-5.1.3-1">Collectors statefully interact with aggregators to produce an aggregate output.
Their input to the protocol is the task parameters, configured out of band,
which include the corresponding batch window and size. For each collect
invocation, collectors are required to keep state from the start of the protocol
to the end as needed to produce the final aggregate output.<a href="#section-5.1.3-1" class="pilcrow">¶</a></p>
<p id="section-5.1.3-2">Collectors must also maintain state for the lifetime of each task, which
includes key material associated with the HPKE key configuration.<a href="#section-5.1.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="data-resolution-limitations">
<section id="section-5.2">
        <h3 id="name-data-resolution-limitations">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-data-resolution-limitations" class="section-name selfRef">Data resolution limitations</a>
        </h3>
<p id="section-5.2-1">Privacy comes at the cost of computational complexity. While affine-aggregatable
encodings (AFEs) can compute many useful statistics, they require more bandwidth
and CPU cycles to account for finite-field arithmetic during input-validation.
The increased work from verifying inputs decreases the throughput of the system
or the inputs processed per unit time. Throughput is related to the verification
circuit's complexity and the available compute-time to each aggregator.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">Applications that utilize proofs with a large number of multiplication gates or
a high frequency of inputs may need to limit inputs into the system to meet
bandwidth or compute constraints. Some methods of overcoming these limitations
include choosing a better representation for the data or introducing sampling
into the data collection methodology.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">[[TODO: Discuss explicit key performance indicators, here or elsewhere.]]<a href="#section-5.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregation-utility-and-soft-batch-deadlines">
<section id="section-5.3">
        <h3 id="name-aggregation-utility-and-sof">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-aggregation-utility-and-sof" class="section-name selfRef">Aggregation utility and soft batch deadlines</a>
        </h3>
<p id="section-5.3-1">A soft real-time system should produce a response within a deadline to be
useful. This constraint may be relevant when the value of an aggregate decreases
over time. A missed deadline can reduce an aggregate's utility but not
necessarily cause failure in the system.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">An example of a soft real-time constraint is the expectation that input data can
be verified and aggregated in a period equal to data collection, given some
computational budget. Meeting these deadlines will require efficient
implementations of the input-validation protocol. Applications might batch
requests or utilize more efficient serialization to improve throughput.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">Some applications may be constrained by the time that it takes to reach a
privacy threshold defined by a minimum number of reports. One possible solution
is to increase the reporting period so more samples can be collected, balanced
against the urgency of responding to a soft deadline.<a href="#section-5.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="protocol-specific-optimizations">
<section id="section-5.4">
        <h3 id="name-protocol-specific-optimizat">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-protocol-specific-optimizat" class="section-name selfRef">Protocol-specific optimizations</a>
        </h3>
<p id="section-5.4-1">Not all DAP tasks have the same operational requirements, so the protocol is
designed to allow implementations to reduce operational costs in certain cases.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<div id="reducing-storage-requirements">
<section id="section-5.4.1">
          <h4 id="name-reducing-storage-requiremen">
<a href="#section-5.4.1" class="section-number selfRef">5.4.1. </a><a href="#name-reducing-storage-requiremen" class="section-name selfRef">Reducing storage requirements</a>
          </h4>
<p id="section-5.4.1-1">In general, the aggregators are required to keep state for all valid reports for
as long as collect requests can be made for them. In particular, the aggregators
must store a batch as long as the batch has not been queried more than
<code>max_batch_lifetime</code> times. However, it is not always necessary to store the
reports themselves. For schemes like Prio in which the input-validation protocol
is only run once per report, each aggregator only needs to store its
aggregate share for each possible batch interval, along with the number of times
the aggregate share was used in a batch. This is due to the requirement that the
batch interval respect the boundaries defined by the DAP parameters. (See
<a href="#batch-parameter-validation" class="xref">Section 4.4.5</a>.)<a href="#section-5.4.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-considerations">
<section id="section-6">
      <h2 id="name-security-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-6-1">DAP assumes an active attacker that controls the network and has the ability to
statically corrupt any number of clients, aggregators, and collectors. That is,
the attacker can learn the secret state of any party prior to the start of its
attack. For example, it may coerce a client into providing malicious input
shares for aggregation or coerce an aggregator into diverting from the
protocol specified (e.g., by divulging its input shares to the attacker).<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">In the presence of this adversary, DAP aims to achieve the following high-level
secure aggregation goals:<a href="#section-6-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-3">
<li id="section-6-3.1">Privacy. Clients trust that some aggregator is honest. That is, as long as at
least one aggregator executes the protocol faithfully, the parties learn nothing
beyond the aggregate result (i.e., the output of the aggregation function computed over
the honest measurements).<a href="#section-6-3.1" class="pilcrow">¶</a>
</li>
        <li id="section-6-3.2">Correctness. The collector trusts that the aggregators execute the protocol
correctly. That is, as long as the aggregators execute the protocol faithfully,
a malicious client can skew the aggregate result only by reporting
a false (untruthful) measurement. The result cannot be influenced in any
other way.<a href="#section-6-3.2" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-6-4">Currently, the specification does not achieve these goals. In particular, there are several open
issues that need to be addressed before these goals are met. Details for each issue are below.<a href="#section-6-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-5">
<li id="section-6-5.1">When crafted maliciously, collect requests may leak more information about
the measurements than the system intends. For example, the spec currently
allows sequences of collect requests to reveal an aggregate result for a
batch smaller than the minimum batch size. [OPEN ISSUE: See issue#195. This
also has implications for how we solve issue#183.]<a href="#section-6-5.1" class="pilcrow">¶</a>
</li>
        <li id="section-6-5.2">Even benign collect requests may leak information beyond what one might
expect intuitively. For example, the Poplar1 VDAF
<span>[<a href="#VDAF" class="xref">VDAF</a>]</span> can be used to compute the set of heavy
hitters among a set of arbitrary bit strings uploaded by clients. This
requires multiple evaluations of the VDAF, the results of which reveal
information to the aggregators and collector beyond what follows from the
heavy hitters themselves. Note that this leakage can be mitigated using
differential privacy. [OPEN ISSUE: We have yet not specified how to add DP.]<a href="#section-6-5.2" class="pilcrow">¶</a>
</li>
        <li id="section-6-5.3">The core DAP spec does not defend against Sybil attacks. In this type of
attack, the adversary adds to a batch a number of reports that skew the
aggregate result in its favor. For example: The result may reveal additional
information about the honest measurements, leading to a privacy violation; or
the result may have some property that is desirable to the adversary ("stats
poisoning"). The upload sub-protocol includes an extensions mechanism that
can be used to prevent --- or at least mitigate --- these types of attacks.
See <a href="#upload-extensions" class="xref">Section 4.2.3</a>. [OPEN ISSUE: No such extension has been
implemented, so we're not yet sure if the current mechanism is sufficient.]<a href="#section-6-5.3" class="pilcrow">¶</a>
</li>
        <li id="section-6-5.4">Attacks may also come from the network. Thus, it is required that the
aggregators and collector communicate with one another over mutually
authenticated and confidential channels.<a href="#section-6-5.4" class="pilcrow">¶</a>
</li>
      </ol>
<div id="threat-model">
<section id="section-6.1">
        <h3 id="name-threat-model">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-threat-model" class="section-name selfRef">Threat model</a>
        </h3>
<p id="section-6.1-1">[OPEN ISSUE: This subsection is a bit out-of-date.]<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">In this section, we enumerate the actors participating in the Prio system and
enumerate their assets (secrets that are either inherently valuable or which
confer some capability that enables further attack on the system), the
capabilities that a malicious or compromised actor has, and potential
mitigations for attacks enabled by those capabilities.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">This model assumes that all participants have previously agreed upon and
exchanged all shared parameters over some unspecified secure channel.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<div id="clientuser">
<section id="section-6.1.1">
          <h4 id="name-client-user">
<a href="#section-6.1.1" class="section-number selfRef">6.1.1. </a><a href="#name-client-user" class="section-name selfRef">Client/user</a>
          </h4>
<div id="assets">
<section id="section-6.1.1.1">
            <h5 id="name-assets">
<a href="#section-6.1.1.1" class="section-number selfRef">6.1.1.1. </a><a href="#name-assets" class="section-name selfRef">Assets</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-6.1.1.1-1">
<li id="section-6.1.1.1-1.1">Unshared inputs. Clients are the only actor that can ever see the original
inputs.<a href="#section-6.1.1.1-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.1.1-1.2">Unencrypted input shares.<a href="#section-6.1.1.1-1.2" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="capabilities">
<section id="section-6.1.1.2">
            <h5 id="name-capabilities">
<a href="#section-6.1.1.2" class="section-number selfRef">6.1.1.2. </a><a href="#name-capabilities" class="section-name selfRef">Capabilities</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-6.1.1.2-1">
<li id="section-6.1.1.2-1.1">Individual users can reveal their own input and compromise their own privacy.<a href="#section-6.1.1.2-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.1.2-1.2">Clients (that is, software which might be used by many users of the system)
can defeat privacy by leaking input outside of the Prio system.<a href="#section-6.1.1.2-1.2" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.1.2-1.3">
                <p id="section-6.1.1.2-1.3.1">Clients may affect the quality of aggregations by reporting false input.<a href="#section-6.1.1.2-1.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.1.2-1.3.2.1">Prio can only prove that submitted input is valid, not that it is true.
False input can be mitigated orthogonally to the Prio protocol (e.g., by
requiring that aggregations include a minimum number of contributions)
and so these attacks are considered to be outside of the threat model.<a href="#section-6.1.1.2-1.3.2.1" class="pilcrow">¶</a>
</li>
                </ul>
</li>
              <li id="section-6.1.1.2-1.4">Clients can send invalid encodings of input.<a href="#section-6.1.1.2-1.4" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="mitigations">
<section id="section-6.1.1.3">
            <h5 id="name-mitigations">
<a href="#section-6.1.1.3" class="section-number selfRef">6.1.1.3. </a><a href="#name-mitigations" class="section-name selfRef">Mitigations</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-6.1.1.3-1">
<li id="section-6.1.1.3-1.1">The input validation protocol executed by the aggregators prevents either
individual clients or coalitions of clients from compromising the robustness
property.<a href="#section-6.1.1.3-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.1.3-1.2">If aggregator output satisifes differential privacy <a href="#dp" class="xref">Section 6.5</a>, then all records
not leaked by malicious clients are still protected.<a href="#section-6.1.1.3-1.2" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
</section>
</div>
<div id="aggregator">
<section id="section-6.1.2">
          <h4 id="name-aggregator">
<a href="#section-6.1.2" class="section-number selfRef">6.1.2. </a><a href="#name-aggregator" class="section-name selfRef">Aggregator</a>
          </h4>
<div id="assets-1">
<section id="section-6.1.2.1">
            <h5 id="name-assets-2">
<a href="#section-6.1.2.1" class="section-number selfRef">6.1.2.1. </a><a href="#name-assets-2" class="section-name selfRef">Assets</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-6.1.2.1-1">
<li id="section-6.1.2.1-1.1">Unencrypted input shares.<a href="#section-6.1.2.1-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.2.1-1.2">Input share decryption keys.<a href="#section-6.1.2.1-1.2" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.2.1-1.3">Client identifying information.<a href="#section-6.1.2.1-1.3" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.2.1-1.4">Aggregate shares.<a href="#section-6.1.2.1-1.4" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.2.1-1.5">Aggregator identity.<a href="#section-6.1.2.1-1.5" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="capabilities-1">
<section id="section-6.1.2.2">
            <h5 id="name-capabilities-2">
<a href="#section-6.1.2.2" class="section-number selfRef">6.1.2.2. </a><a href="#name-capabilities-2" class="section-name selfRef">Capabilities</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-6.1.2.2-1">
<li id="section-6.1.2.2-1.1">Aggregators may defeat the robustness of the system by emitting bogus output
shares.<a href="#section-6.1.2.2-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.2.2-1.2">
                <p id="section-6.1.2.2-1.2.1">If clients reveal identifying information to aggregators (such as a trusted
identity during client authentication), aggregators can learn which clients are
contributing input.<a href="#section-6.1.2.2-1.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.1.2.2-1.2.2">
<li id="section-6.1.2.2-1.2.2.1">Aggregators may reveal that a particular client contributed input.<a href="#section-6.1.2.2-1.2.2.1" class="pilcrow">¶</a>
</li>
                  <li id="section-6.1.2.2-1.2.2.2">
                    <p id="section-6.1.2.2-1.2.2.2.1">Aggregators may attack robustness by selectively omitting inputs from
certain clients.<a href="#section-6.1.2.2-1.2.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.2.2-1.2.2.2.2.1">For example, omitting submissions from a particular geographic
region to falsely suggest that a particular localization is not
being used.<a href="#section-6.1.2.2-1.2.2.2.2.1" class="pilcrow">¶</a>
</li>
                    </ul>
</li>
                </ol>
</li>
              <li id="section-6.1.2.2-1.3">Individual aggregators may compromise availability of the system by refusing
to emit aggregate shares.<a href="#section-6.1.2.2-1.3" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.2.2-1.4">Input validity proof forging. Any aggregator can collude with a malicious
client to craft a proof that will fool honest aggregators into accepting
invalid input.<a href="#section-6.1.2.2-1.4" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.2.2-1.5">Aggregators can count the total number of input shares, which could
compromise user privacy (and differential privacy <a href="#dp" class="xref">Section 6.5</a>) if the presence or
absence of a share for a given user is sensitive.<a href="#section-6.1.2.2-1.5" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="mitigations-1">
<section id="section-6.1.2.3">
            <h5 id="name-mitigations-2">
<a href="#section-6.1.2.3" class="section-number selfRef">6.1.2.3. </a><a href="#name-mitigations-2" class="section-name selfRef">Mitigations</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-6.1.2.3-1">
<li id="section-6.1.2.3-1.1">The linear secret sharing scheme employed by the client ensures that privacy
is preserved as long as at least one aggregator does not reveal its input
shares.<a href="#section-6.1.2.3-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.2.3-1.2">If computed over a sufficient number of reports, aggregate shares reveal
nothing about either the inputs or the participating clients.<a href="#section-6.1.2.3-1.2" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.2.3-1.3">Clients can ensure that aggregate counts are non-sensitive by generating
input independently of user behavior. For example, a client should
periodically upload a report even if the event that the task is tracking has
not occurred, so that the absence of reports cannot be distinguished from
their presence.<a href="#section-6.1.2.3-1.3" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.2.3-1.4">
                <p id="section-6.1.2.3-1.4.1">Bogus inputs can be generated that encode "null" shares that do not affect
the aggregate output, but mask the total number of true inputs.<a href="#section-6.1.2.3-1.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.2.3-1.4.2.1">Either leaders or clients can generate these inputs to mask the total
number from non-leader aggregators or all the aggregators, respectively.<a href="#section-6.1.2.3-1.4.2.1" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-6.1.2.3-1.4.2.2">In either case, care must be taken to ensure that bogus inputs are
indistinguishable from true inputs (metadata, etc), especially when
constructing timestamps on reports.<a href="#section-6.1.2.3-1.4.2.2" class="pilcrow">¶</a>
</li>
                </ul>
</li>
            </ol>
<p id="section-6.1.2.3-2">[OPEN ISSUE: Define what "null" shares are. They should be defined such that
inserting null shares into an aggregation is effectively a no-op. See issue#98.]<a href="#section-6.1.2.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="leader">
<section id="section-6.1.3">
          <h4 id="name-leader">
<a href="#section-6.1.3" class="section-number selfRef">6.1.3. </a><a href="#name-leader" class="section-name selfRef">Leader</a>
          </h4>
<p id="section-6.1.3-1">The leader is also an aggregator, and so all the assets, capabilities and
mitigations available to aggregators also apply to the leader.<a href="#section-6.1.3-1" class="pilcrow">¶</a></p>
<div id="capabilities-2">
<section id="section-6.1.3.1">
            <h5 id="name-capabilities-3">
<a href="#section-6.1.3.1" class="section-number selfRef">6.1.3.1. </a><a href="#name-capabilities-3" class="section-name selfRef">Capabilities</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-6.1.3.1-1">
<li id="section-6.1.3.1-1.1">
                <p id="section-6.1.3.1-1.1.1">Input validity proof verification. The leader can forge proofs and collude
with a malicious client to trick aggregators into aggregating invalid inputs.<a href="#section-6.1.3.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.3.1-1.1.2.1">This capability is no stronger than any aggregator's ability to forge
validity proof in collusion with a malicious client.<a href="#section-6.1.3.1-1.1.2.1" class="pilcrow">¶</a>
</li>
                </ul>
</li>
              <li id="section-6.1.3.1-1.2">
                <p id="section-6.1.3.1-1.2.1">Relaying messages between aggregators. The leader can compromise availability
by dropping messages.<a href="#section-6.1.3.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.3.1-1.2.2.1">This capability is no stronger than any aggregator's ability to refuse to
emit aggregate shares.<a href="#section-6.1.3.1-1.2.2.1" class="pilcrow">¶</a>
</li>
                </ul>
</li>
              <li id="section-6.1.3.1-1.3">Shrinking the anonymity set. The leader instructs aggregators to construct
output parts and so could request aggregations over few inputs.<a href="#section-6.1.3.1-1.3" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="mitigations-2">
<section id="section-6.1.3.2">
            <h5 id="name-mitigations-3">
<a href="#section-6.1.3.2" class="section-number selfRef">6.1.3.2. </a><a href="#name-mitigations-3" class="section-name selfRef">Mitigations</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-6.1.3.2-1">
<li id="section-6.1.3.2-1.1">Aggregators enforce agreed upon minimum aggregation thresholds to prevent
deanonymizing.<a href="#section-6.1.3.2-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.3.2-1.2">If aggregator output satisfies differential privacy <a href="#dp" class="xref">Section 6.5</a>, then genuine
records are protected regardless of the size of the anonymity set.<a href="#section-6.1.3.2-1.2" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
</section>
</div>
<div id="collector">
<section id="section-6.1.4">
          <h4 id="name-collector">
<a href="#section-6.1.4" class="section-number selfRef">6.1.4. </a><a href="#name-collector" class="section-name selfRef">Collector</a>
          </h4>
<div id="capabilities-3">
<section id="section-6.1.4.1">
            <h5 id="name-capabilities-4">
<a href="#section-6.1.4.1" class="section-number selfRef">6.1.4.1. </a><a href="#name-capabilities-4" class="section-name selfRef">Capabilities</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-6.1.4.1-1">
<li id="section-6.1.4.1-1.1">Advertising shared configuration parameters (e.g., minimum thresholds for
aggregations, joint randomness, arithmetic circuits).<a href="#section-6.1.4.1-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.4.1-1.2">Collectors may trivially defeat availability by discarding aggregate shares
submitted by aggregators.<a href="#section-6.1.4.1-1.2" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.4.1-1.3">Known input injection. Collectors may collude with clients to send known
input to the aggregators, allowing collectors to shrink the effective
anonymity set by subtracting the known inputs from the final output. Sybil
attacks <span>[<a href="#Dou02" class="xref">Dou02</a>]</span> could be used to amplify this capability.<a href="#section-6.1.4.1-1.3" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="mitigations-3">
<section id="section-6.1.4.2">
            <h5 id="name-mitigations-4">
<a href="#section-6.1.4.2" class="section-number selfRef">6.1.4.2. </a><a href="#name-mitigations-4" class="section-name selfRef">Mitigations</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-6.1.4.2-1">
<li id="section-6.1.4.2-1.1">Aggregators should refuse shared parameters that are trivially insecure
(i.e., aggregation threshold of 1 contribution).<a href="#section-6.1.4.2-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.4.2-1.2">If aggregator output satisfies differential privacy <a href="#dp" class="xref">Section 6.5</a>, then genuine
records are protected regardless of the size of the anonymity set.<a href="#section-6.1.4.2-1.2" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
</section>
</div>
<div id="aggregator-collusion">
<section id="section-6.1.5">
          <h4 id="name-aggregator-collusion">
<a href="#section-6.1.5" class="section-number selfRef">6.1.5. </a><a href="#name-aggregator-collusion" class="section-name selfRef">Aggregator collusion</a>
          </h4>
<p id="section-6.1.5-1">If all aggregators collude (e.g. by promiscuously sharing unencrypted input
shares), then none of the properties of the system hold. Accordingly, such
scenarios are outside of the threat model.<a href="#section-6.1.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="attacker-on-the-network">
<section id="section-6.1.6">
          <h4 id="name-attacker-on-the-network">
<a href="#section-6.1.6" class="section-number selfRef">6.1.6. </a><a href="#name-attacker-on-the-network" class="section-name selfRef">Attacker on the network</a>
          </h4>
<p id="section-6.1.6-1">We assume the existence of attackers on the network links between participants.<a href="#section-6.1.6-1" class="pilcrow">¶</a></p>
<div id="capabilities-4">
<section id="section-6.1.6.1">
            <h5 id="name-capabilities-5">
<a href="#section-6.1.6.1" class="section-number selfRef">6.1.6.1. </a><a href="#name-capabilities-5" class="section-name selfRef">Capabilities</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-6.1.6.1-1">
<li id="section-6.1.6.1-1.1">
                <p id="section-6.1.6.1-1.1.1">Observation of network traffic. Attackers may observe messages exchanged
between participants at the IP layer.<a href="#section-6.1.6.1-1.1.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.1.6.1-1.1.2">
<li id="section-6.1.6.1-1.1.2.1">
                    <p id="section-6.1.6.1-1.1.2.1.1">The time of transmission of input shares by clients could reveal
information about user activity.<a href="#section-6.1.6.1-1.1.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.6.1-1.1.2.1.2.1">For example, if a user opts into a new feature, and the client
immediately reports this to aggregators, then just by observing
network traffic, the attacker can infer what the user did.<a href="#section-6.1.6.1-1.1.2.1.2.1" class="pilcrow">¶</a>
</li>
                    </ul>
</li>
                  <li id="section-6.1.6.1-1.1.2.2">
                    <p id="section-6.1.6.1-1.1.2.2.1">Observation of message size could allow the attacker to learn how much
input is being submitted by a client.<a href="#section-6.1.6.1-1.1.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.6.1-1.1.2.2.2.1">For example, if the attacker observes an encrypted message of some
size, they can infer the size of the plaintext, plus or minus the
cipher block size. From this they may be able to infer which
aggregations the user has opted into or out of.<a href="#section-6.1.6.1-1.1.2.2.2.1" class="pilcrow">¶</a>
</li>
                    </ul>
</li>
                </ol>
</li>
              <li id="section-6.1.6.1-1.2">Tampering with network traffic. Attackers may drop messages or inject new
messages into communications between participants.<a href="#section-6.1.6.1-1.2" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="mitigations-4">
<section id="section-6.1.6.2">
            <h5 id="name-mitigations-5">
<a href="#section-6.1.6.2" class="section-number selfRef">6.1.6.2. </a><a href="#name-mitigations-5" class="section-name selfRef">Mitigations</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-6.1.6.2-1">
<li id="section-6.1.6.2-1.1">All messages exchanged between participants in the system should be
encrypted.<a href="#section-6.1.6.2-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.6.2-1.2">All messages exchanged between aggregators, the collector and the leader
should be mutually authenticated so that network attackers cannot impersonate
participants.<a href="#section-6.1.6.2-1.2" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.6.2-1.3">Clients should be required to submit inputs at regular intervals so that the
timing of individual messages does not reveal anything.<a href="#section-6.1.6.2-1.3" class="pilcrow">¶</a>
</li>
              <li id="section-6.1.6.2-1.4">Clients should submit dummy inputs even for aggregations the user has not
opted into.<a href="#section-6.1.6.2-1.4" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-6.1.6.2-2">[[OPEN ISSUE: The threat model for Prio --- as it's described in the original
paper and <span>[<a href="#BBCGGI19" class="xref">BBCGGI19</a>]</span> --- considers <strong>either</strong> a malicious client (attacking
soundness) <strong>or</strong> a malicious subset of aggregators (attacking privacy). In
particular, soundness isn't guaranteed if any one of the aggregators is
malicious; in theory it may be possible for a malicious client and aggregator to
collude and break soundness. Is this a contingency we need to address? There are
techniques in <span>[<a href="#BBCGGI19" class="xref">BBCGGI19</a>]</span> that account for this; we need to figure out if they're
practical.]]<a href="#section-6.1.6.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="client-authentication-or-attestation">
<section id="section-6.2">
        <h3 id="name-client-authentication-or-at">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-client-authentication-or-at" class="section-name selfRef">Client authentication or attestation</a>
        </h3>
<p id="section-6.2-1">[TODO: Solve issue#89]<a href="#section-6.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="anon-proxy">
<section id="section-6.3">
        <h3 id="name-anonymizing-proxies">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-anonymizing-proxies" class="section-name selfRef">Anonymizing proxies</a>
        </h3>
<p id="section-6.3-1">Client reports can contain auxiliary information such as source IP, HTTP user
agent or in deployments which use it, client authentication information, which
could be used by aggregators to identify participating clients or permit some
attacks on robustness. This auxiliary information could be removed by having
clients submit reports to an anonymizing proxy server which would then use
Oblivous HTTP <span>[<a href="#I-D.thomson-http-oblivious" class="xref">I-D.thomson-http-oblivious</a>]</span> to forward inputs to the DAP
leader, without requiring any server participating in DAP to be aware of
whatever client authentication or attestation scheme is in use.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="batch-parameters">
<section id="section-6.4">
        <h3 id="name-batch-parameters">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-batch-parameters" class="section-name selfRef">Batch parameters</a>
        </h3>
<p id="section-6.4-1">An important parameter of a DAP deployment is the minimum batch size. If an
aggregation includes too few inputs, then the outputs can reveal information
about individual participants. Aggregators use the batch size field of the
shared task parameters to enforce minimum batch size during the collect
protocol, but server implementations may also opt out of participating in a DAP
task if the minimum batch size is too small. This document does not specify how
to choose minimum batch sizes.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<p id="section-6.4-2">The DAP parameters also specify the maximum number of times a report can be
used. Some protocols, such as Poplar <span>[<a href="#BBCGGI21" class="xref">BBCGGI21</a>]</span>, require reports to be used in
multiple batches spanning multiple collect requests.<a href="#section-6.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="dp">
<section id="section-6.5">
        <h3 id="name-differential-privacy">
<a href="#section-6.5" class="section-number selfRef">6.5. </a><a href="#name-differential-privacy" class="section-name selfRef">Differential privacy</a>
        </h3>
<p id="section-6.5-1">Optionally, DAP deployments can choose to ensure their output F achieves
differential privacy <span>[<a href="#Vad16" class="xref">Vad16</a>]</span>. A simple approach would require the aggregators
to add two-sided noise (e.g. sampled from a two-sided geometric distribution) to
outputs. Since each aggregator is adding noise independently, privacy can be
guaranteed even if all but one of the aggregators is malicious. Differential
privacy is a strong privacy definition, and protects users in extreme
circumstances: Even if an adversary has prior knowledge of every input in a
batch except for one, that one record is still formally protected.<a href="#section-6.5-1" class="pilcrow">¶</a></p>
<p id="section-6.5-2">[OPEN ISSUE: While parameters configuring the differential privacy noise (like
specific distributions / variance) can be agreed upon out of band by the
aggregators and collector, there may be benefits to adding explicit protocol
support by encoding them into task parameters.]<a href="#section-6.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="robustness-in-the-presence-of-malicious-servers">
<section id="section-6.6">
        <h3 id="name-robustness-in-the-presence-">
<a href="#section-6.6" class="section-number selfRef">6.6. </a><a href="#name-robustness-in-the-presence-" class="section-name selfRef">Robustness in the presence of malicious servers</a>
        </h3>
<p id="section-6.6-1">Most DAP protocols, including Prio and Poplar, are robust against malicious
clients, but are not robust against malicious servers. Any aggregator can simply
emit bogus aggregate shares and undetectably spoil aggregates. If enough
aggregators were available, this could be mitigated by running the protocol
multiple times with distinct subsets of aggregators chosen so that no aggregator
appears in all subsets and checking all the outputs against each other. If all
the protocol runs do not agree, then participants know that at least one
aggregator is defective, and it may be possible to identify the defector (i.e.,
if a majority of runs agree, and a single aggregator appears in every run that
disagrees). See
<a href="https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap/issues/22">#22</a> for
discussion.<a href="#section-6.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="infrastructure-diversity">
<section id="section-6.7">
        <h3 id="name-infrastructure-diversity">
<a href="#section-6.7" class="section-number selfRef">6.7. </a><a href="#name-infrastructure-diversity" class="section-name selfRef">Infrastructure diversity</a>
        </h3>
<p id="section-6.7-1">Prio deployments should ensure that aggregators do not have common dependencies
that would enable a single vendor to reassemble inputs. For example, if all
participating aggregators stored unencrypted input shares on the same cloud
object storage service, then that cloud vendor would be able to reassemble all
the input shares and defeat privacy.<a href="#section-6.7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="operational-requirements">
<section id="section-6.8">
        <h3 id="name-system-requirements">
<a href="#section-6.8" class="section-number selfRef">6.8. </a><a href="#name-system-requirements" class="section-name selfRef">System requirements</a>
        </h3>
<div id="data-types">
<section id="section-6.8.1">
          <h4 id="name-data-types">
<a href="#section-6.8.1" class="section-number selfRef">6.8.1. </a><a href="#name-data-types" class="section-name selfRef">Data types</a>
        </h4>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="protocol-message-media-types">
<section id="section-7.1">
        <h3 id="name-protocol-message-media-type">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-protocol-message-media-type" class="section-name selfRef">Protocol Message Media Types</a>
        </h3>
<p id="section-7.1-1">This specification defines the following protocol messages, along with their
corresponding media types types:<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-2.1">HpkeConfig <a href="#hpke-config" class="xref">Section 4.2.1</a>: "application/dap-hpke-config"<a href="#section-7.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.1-2.2">Report <a href="#upload-request" class="xref">Section 4.2.2</a>: "message/dap-report"<a href="#section-7.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.1-2.3">AggregateInitializeReq <a href="#collect-flow" class="xref">Section 4.4</a>: "message/dap-aggregate-initialize-req"<a href="#section-7.1-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.1-2.4">AggregateInitializeResp <a href="#collect-flow" class="xref">Section 4.4</a>: "message/dap-aggregate-initialize-resp"<a href="#section-7.1-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.1-2.5">AggregateContinueReq <a href="#collect-flow" class="xref">Section 4.4</a>: "message/dap-aggregate-continue-req"<a href="#section-7.1-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.1-2.6">AggregateContinueResp <a href="#collect-flow" class="xref">Section 4.4</a>: "message/dap-aggregate-continue-resp"<a href="#section-7.1-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.1-2.7">AggregateShareReq <a href="#collect-flow" class="xref">Section 4.4</a>: "message/dap-aggregate-share-req"<a href="#section-7.1-2.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.1-2.8">AggregateShareResp <a href="#collect-flow" class="xref">Section 4.4</a>: "message/dap-aggregate-share-resp"<a href="#section-7.1-2.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.1-2.9">CollectReq <a href="#collect-flow" class="xref">Section 4.4</a>: "message/dap-collect-req"<a href="#section-7.1-2.9" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.1-2.10">CollectResp <a href="#collect-flow" class="xref">Section 4.4</a>: "message/dap-collect-resp"<a href="#section-7.1-2.10" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-7.1-3">The definition for each media type is in the following subsections.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<p id="section-7.1-4">Protocol message format evolution is supported through the definition of new
formats that are identified by new media types.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
<p id="section-7.1-5">IANA [shall update / has updated] the "Media Types" registry at
https://www.iana.org/assignments/media-types with the registration information
in this section for all media types listed above.<a href="#section-7.1-5" class="pilcrow">¶</a></p>
<p id="section-7.1-6">[OPEN ISSUE: Solicit review of these allocations from domain experts.]<a href="#section-7.1-6" class="pilcrow">¶</a></p>
<div id="applicationdap-hpke-config-media-type">
<section id="section-7.1.1">
          <h4 id="name-application-dap-hpke-config">
<a href="#section-7.1.1" class="section-number selfRef">7.1.1. </a><a href="#name-application-dap-hpke-config" class="section-name selfRef">"application/dap-hpke-config" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-7.1.1-1">
            <dt id="section-7.1.1-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.2">
              <p id="section-7.1.1-1.2.1">application<a href="#section-7.1.1-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.4">
              <p id="section-7.1.1-1.4.1">dap-hpke-config<a href="#section-7.1.1-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.6">
              <p id="section-7.1.1-1.6.1">N/A<a href="#section-7.1.1-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.8">
              <p id="section-7.1.1-1.8.1">None<a href="#section-7.1.1-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.10">
              <p id="section-7.1.1-1.10.1">only "8bit" or "binary" is permitted<a href="#section-7.1.1-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.12">
              <p id="section-7.1.1-1.12.1">see <a href="#task-configuration" class="xref">Section 4.1</a><a href="#section-7.1.1-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.14">
              <p id="section-7.1.1-1.14.1">N/A<a href="#section-7.1.1-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.16">
              <p id="section-7.1.1-1.16.1">this specification<a href="#section-7.1.1-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.18">
              <p id="section-7.1.1-1.18.1">N/A<a href="#section-7.1.1-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.20">
              <p id="section-7.1.1-1.20.1">N/A<a href="#section-7.1.1-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-7.1.1-1.22.1">
                <dt id="section-7.1.1-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.1-1.22.1.2">N/A<a href="#section-7.1.1-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.1-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.1-1.22.1.4">N/A<a href="#section-7.1.1-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.1-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.1-1.22.1.6">N/A<a href="#section-7.1.1-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.1-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.1-1.22.1.8">N/A<a href="#section-7.1.1-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.24">
              <p id="section-7.1.1-1.24.1">see Authors' Addresses section<a href="#section-7.1.1-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.26">
              <p id="section-7.1.1-1.26.1">COMMON<a href="#section-7.1.1-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.28">
              <p id="section-7.1.1-1.28.1">N/A<a href="#section-7.1.1-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.30">
              <p id="section-7.1.1-1.30.1">see Authors' Addresses section<a href="#section-7.1.1-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.1-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.1-1.32">
              <p id="section-7.1.1-1.32.1">IESG<a href="#section-7.1.1-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="messagedap-report-media-type">
<section id="section-7.1.2">
          <h4 id="name-message-dap-report-media-ty">
<a href="#section-7.1.2" class="section-number selfRef">7.1.2. </a><a href="#name-message-dap-report-media-ty" class="section-name selfRef">"message/dap-report" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-7.1.2-1">
            <dt id="section-7.1.2-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.2">
              <p id="section-7.1.2-1.2.1">message<a href="#section-7.1.2-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.4">
              <p id="section-7.1.2-1.4.1">dap-report<a href="#section-7.1.2-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.6">
              <p id="section-7.1.2-1.6.1">N/A<a href="#section-7.1.2-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.8">
              <p id="section-7.1.2-1.8.1">None<a href="#section-7.1.2-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.10">
              <p id="section-7.1.2-1.10.1">only "8bit" or "binary" is permitted<a href="#section-7.1.2-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.12">
              <p id="section-7.1.2-1.12.1">see <a href="#upload-request" class="xref">Section 4.2.2</a><a href="#section-7.1.2-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.14">
              <p id="section-7.1.2-1.14.1">N/A<a href="#section-7.1.2-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.16">
              <p id="section-7.1.2-1.16.1">this specification<a href="#section-7.1.2-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.18">
              <p id="section-7.1.2-1.18.1">N/A<a href="#section-7.1.2-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.20">
              <p id="section-7.1.2-1.20.1">N/A<a href="#section-7.1.2-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-7.1.2-1.22.1">
                <dt id="section-7.1.2-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.2-1.22.1.2">N/A<a href="#section-7.1.2-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.2-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.2-1.22.1.4">N/A<a href="#section-7.1.2-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.2-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.2-1.22.1.6">N/A<a href="#section-7.1.2-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.2-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.2-1.22.1.8">N/A<a href="#section-7.1.2-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.24">
              <p id="section-7.1.2-1.24.1">see Authors' Addresses section<a href="#section-7.1.2-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.26">
              <p id="section-7.1.2-1.26.1">COMMON<a href="#section-7.1.2-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.28">
              <p id="section-7.1.2-1.28.1">N/A<a href="#section-7.1.2-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.30">
              <p id="section-7.1.2-1.30.1">see Authors' Addresses section<a href="#section-7.1.2-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.2-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.2-1.32">
              <p id="section-7.1.2-1.32.1">IESG<a href="#section-7.1.2-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="messagedap-aggregate-continue-req-media-type">
<section id="section-7.1.3">
          <h4 id="name-message-dap-aggregate-conti">
<a href="#section-7.1.3" class="section-number selfRef">7.1.3. </a><a href="#name-message-dap-aggregate-conti" class="section-name selfRef">"message/dap-aggregate-continue-req" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-7.1.3-1">
            <dt id="section-7.1.3-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.2">
              <p id="section-7.1.3-1.2.1">message<a href="#section-7.1.3-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.4">
              <p id="section-7.1.3-1.4.1">dap-aggregate-initialize-req<a href="#section-7.1.3-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.6">
              <p id="section-7.1.3-1.6.1">N/A<a href="#section-7.1.3-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.8">
              <p id="section-7.1.3-1.8.1">None<a href="#section-7.1.3-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.10">
              <p id="section-7.1.3-1.10.1">only "8bit" or "binary" is permitted<a href="#section-7.1.3-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.12">
              <p id="section-7.1.3-1.12.1">see <a href="#collect-flow" class="xref">Section 4.4</a><a href="#section-7.1.3-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.14">
              <p id="section-7.1.3-1.14.1">N/A<a href="#section-7.1.3-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.16">
              <p id="section-7.1.3-1.16.1">this specification<a href="#section-7.1.3-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.18">
              <p id="section-7.1.3-1.18.1">N/A<a href="#section-7.1.3-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.20">
              <p id="section-7.1.3-1.20.1">N/A<a href="#section-7.1.3-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-7.1.3-1.22.1">
                <dt id="section-7.1.3-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.3-1.22.1.2">N/A<a href="#section-7.1.3-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.3-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.3-1.22.1.4">N/A<a href="#section-7.1.3-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.3-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.3-1.22.1.6">N/A<a href="#section-7.1.3-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.3-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.3-1.22.1.8">N/A<a href="#section-7.1.3-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.24">
              <p id="section-7.1.3-1.24.1">see Authors' Addresses section<a href="#section-7.1.3-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.26">
              <p id="section-7.1.3-1.26.1">COMMON<a href="#section-7.1.3-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.28">
              <p id="section-7.1.3-1.28.1">N/A<a href="#section-7.1.3-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.30">
              <p id="section-7.1.3-1.30.1">see Authors' Addresses section<a href="#section-7.1.3-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.3-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.3-1.32">
              <p id="section-7.1.3-1.32.1">IESG<a href="#section-7.1.3-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="messagedap-aggregate-initialize-resp-media-type">
<section id="section-7.1.4">
          <h4 id="name-message-dap-aggregate-initi">
<a href="#section-7.1.4" class="section-number selfRef">7.1.4. </a><a href="#name-message-dap-aggregate-initi" class="section-name selfRef">"message/dap-aggregate-initialize-resp" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-7.1.4-1">
            <dt id="section-7.1.4-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.2">
              <p id="section-7.1.4-1.2.1">message<a href="#section-7.1.4-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.4">
              <p id="section-7.1.4-1.4.1">dap-aggregate-initialize-resp<a href="#section-7.1.4-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.6">
              <p id="section-7.1.4-1.6.1">N/A<a href="#section-7.1.4-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.8">
              <p id="section-7.1.4-1.8.1">None<a href="#section-7.1.4-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.10">
              <p id="section-7.1.4-1.10.1">only "8bit" or "binary" is permitted<a href="#section-7.1.4-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.12">
              <p id="section-7.1.4-1.12.1">see <a href="#collect-flow" class="xref">Section 4.4</a><a href="#section-7.1.4-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.14">
              <p id="section-7.1.4-1.14.1">N/A<a href="#section-7.1.4-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.16">
              <p id="section-7.1.4-1.16.1">this specification<a href="#section-7.1.4-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.18">
              <p id="section-7.1.4-1.18.1">N/A<a href="#section-7.1.4-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.20">
              <p id="section-7.1.4-1.20.1">N/A<a href="#section-7.1.4-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-7.1.4-1.22.1">
                <dt id="section-7.1.4-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.4-1.22.1.2">N/A<a href="#section-7.1.4-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.4-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.4-1.22.1.4">N/A<a href="#section-7.1.4-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.4-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.4-1.22.1.6">N/A<a href="#section-7.1.4-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.4-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.4-1.22.1.8">N/A<a href="#section-7.1.4-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.24">
              <p id="section-7.1.4-1.24.1">see Authors' Addresses section<a href="#section-7.1.4-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.26">
              <p id="section-7.1.4-1.26.1">COMMON<a href="#section-7.1.4-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.28">
              <p id="section-7.1.4-1.28.1">N/A<a href="#section-7.1.4-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.30">
              <p id="section-7.1.4-1.30.1">see Authors' Addresses section<a href="#section-7.1.4-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.4-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.4-1.32">
              <p id="section-7.1.4-1.32.1">IESG<a href="#section-7.1.4-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="messagedap-aggregate-continue-req-media-type-1">
<section id="section-7.1.5">
          <h4 id="name-message-dap-aggregate-contin">
<a href="#section-7.1.5" class="section-number selfRef">7.1.5. </a><a href="#name-message-dap-aggregate-contin" class="section-name selfRef">"message/dap-aggregate-continue-req" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-7.1.5-1">
            <dt id="section-7.1.5-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.2">
              <p id="section-7.1.5-1.2.1">message<a href="#section-7.1.5-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.4">
              <p id="section-7.1.5-1.4.1">dap-aggregate-continue-req<a href="#section-7.1.5-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.6">
              <p id="section-7.1.5-1.6.1">N/A<a href="#section-7.1.5-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.8">
              <p id="section-7.1.5-1.8.1">None<a href="#section-7.1.5-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.10">
              <p id="section-7.1.5-1.10.1">only "8bit" or "binary" is permitted<a href="#section-7.1.5-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.12">
              <p id="section-7.1.5-1.12.1">see <a href="#collect-flow" class="xref">Section 4.4</a><a href="#section-7.1.5-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.14">
              <p id="section-7.1.5-1.14.1">N/A<a href="#section-7.1.5-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.16">
              <p id="section-7.1.5-1.16.1">this specification<a href="#section-7.1.5-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.18">
              <p id="section-7.1.5-1.18.1">N/A<a href="#section-7.1.5-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.20">
              <p id="section-7.1.5-1.20.1">N/A<a href="#section-7.1.5-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-7.1.5-1.22.1">
                <dt id="section-7.1.5-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.5-1.22.1.2">N/A<a href="#section-7.1.5-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.5-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.5-1.22.1.4">N/A<a href="#section-7.1.5-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.5-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.5-1.22.1.6">N/A<a href="#section-7.1.5-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.5-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.5-1.22.1.8">N/A<a href="#section-7.1.5-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.24">
              <p id="section-7.1.5-1.24.1">see Authors' Addresses section<a href="#section-7.1.5-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.26">
              <p id="section-7.1.5-1.26.1">COMMON<a href="#section-7.1.5-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.28">
              <p id="section-7.1.5-1.28.1">N/A<a href="#section-7.1.5-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.30">
              <p id="section-7.1.5-1.30.1">see Authors' Addresses section<a href="#section-7.1.5-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.5-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.5-1.32">
              <p id="section-7.1.5-1.32.1">IESG<a href="#section-7.1.5-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="messagedap-aggregate-continue-resp-media-type">
<section id="section-7.1.6">
          <h4 id="name-message-dap-aggregate-continu">
<a href="#section-7.1.6" class="section-number selfRef">7.1.6. </a><a href="#name-message-dap-aggregate-continu" class="section-name selfRef">"message/dap-aggregate-continue-resp" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-7.1.6-1">
            <dt id="section-7.1.6-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.2">
              <p id="section-7.1.6-1.2.1">init<a href="#section-7.1.6-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.4">
              <p id="section-7.1.6-1.4.1">dap-aggregate-continue-resp<a href="#section-7.1.6-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.6">
              <p id="section-7.1.6-1.6.1">N/A<a href="#section-7.1.6-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.8">
              <p id="section-7.1.6-1.8.1">None<a href="#section-7.1.6-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.10">
              <p id="section-7.1.6-1.10.1">only "8bit" or "binary" is permitted<a href="#section-7.1.6-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.12">
              <p id="section-7.1.6-1.12.1">see <a href="#collect-flow" class="xref">Section 4.4</a><a href="#section-7.1.6-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.14">
              <p id="section-7.1.6-1.14.1">N/A<a href="#section-7.1.6-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.16">
              <p id="section-7.1.6-1.16.1">this specification<a href="#section-7.1.6-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.18">
              <p id="section-7.1.6-1.18.1">N/A<a href="#section-7.1.6-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.20">
              <p id="section-7.1.6-1.20.1">N/A<a href="#section-7.1.6-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-7.1.6-1.22.1">
                <dt id="section-7.1.6-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.6-1.22.1.2">N/A<a href="#section-7.1.6-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.6-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.6-1.22.1.4">N/A<a href="#section-7.1.6-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.6-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.6-1.22.1.6">N/A<a href="#section-7.1.6-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.6-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.6-1.22.1.8">N/A<a href="#section-7.1.6-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.24">
              <p id="section-7.1.6-1.24.1">see Authors' Addresses section<a href="#section-7.1.6-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.26">
              <p id="section-7.1.6-1.26.1">COMMON<a href="#section-7.1.6-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.28">
              <p id="section-7.1.6-1.28.1">N/A<a href="#section-7.1.6-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.30">
              <p id="section-7.1.6-1.30.1">see Authors' Addresses section<a href="#section-7.1.6-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.6-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.6-1.32">
              <p id="section-7.1.6-1.32.1">IESG<a href="#section-7.1.6-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="messagedap-aggregate-share-req-media-type">
<section id="section-7.1.7">
          <h4 id="name-message-dap-aggregate-share">
<a href="#section-7.1.7" class="section-number selfRef">7.1.7. </a><a href="#name-message-dap-aggregate-share" class="section-name selfRef">"message/dap-aggregate-share-req" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-7.1.7-1">
            <dt id="section-7.1.7-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.2">
              <p id="section-7.1.7-1.2.1">message<a href="#section-7.1.7-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.4">
              <p id="section-7.1.7-1.4.1">dap-aggregate-share-req<a href="#section-7.1.7-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.6">
              <p id="section-7.1.7-1.6.1">N/A<a href="#section-7.1.7-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.8">
              <p id="section-7.1.7-1.8.1">None<a href="#section-7.1.7-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.10">
              <p id="section-7.1.7-1.10.1">only "8bit" or "binary" is permitted<a href="#section-7.1.7-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.12">
              <p id="section-7.1.7-1.12.1">see <a href="#collect-flow" class="xref">Section 4.4</a><a href="#section-7.1.7-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.14">
              <p id="section-7.1.7-1.14.1">N/A<a href="#section-7.1.7-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.16">
              <p id="section-7.1.7-1.16.1">this specification<a href="#section-7.1.7-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.18">
              <p id="section-7.1.7-1.18.1">N/A<a href="#section-7.1.7-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.20">
              <p id="section-7.1.7-1.20.1">N/A<a href="#section-7.1.7-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-7.1.7-1.22.1">
                <dt id="section-7.1.7-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.7-1.22.1.2">N/A<a href="#section-7.1.7-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.7-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.7-1.22.1.4">N/A<a href="#section-7.1.7-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.7-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.7-1.22.1.6">N/A<a href="#section-7.1.7-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.7-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.7-1.22.1.8">N/A<a href="#section-7.1.7-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.24">
              <p id="section-7.1.7-1.24.1">see Authors' Addresses section<a href="#section-7.1.7-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.26">
              <p id="section-7.1.7-1.26.1">COMMON<a href="#section-7.1.7-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.28">
              <p id="section-7.1.7-1.28.1">N/A<a href="#section-7.1.7-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.30">
              <p id="section-7.1.7-1.30.1">see Authors' Addresses section<a href="#section-7.1.7-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.7-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.7-1.32">
              <p id="section-7.1.7-1.32.1">IESG<a href="#section-7.1.7-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="messagedap-aggregate-share-resp-media-type">
<section id="section-7.1.8">
          <h4 id="name-message-dap-aggregate-share-">
<a href="#section-7.1.8" class="section-number selfRef">7.1.8. </a><a href="#name-message-dap-aggregate-share-" class="section-name selfRef">"message/dap-aggregate-share-resp" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-7.1.8-1">
            <dt id="section-7.1.8-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.2">
              <p id="section-7.1.8-1.2.1">message<a href="#section-7.1.8-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.4">
              <p id="section-7.1.8-1.4.1">dap-aggregate-share-resp<a href="#section-7.1.8-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.6">
              <p id="section-7.1.8-1.6.1">N/A<a href="#section-7.1.8-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.8">
              <p id="section-7.1.8-1.8.1">None<a href="#section-7.1.8-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.10">
              <p id="section-7.1.8-1.10.1">only "8bit" or "binary" is permitted<a href="#section-7.1.8-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.12">
              <p id="section-7.1.8-1.12.1">see <a href="#collect-flow" class="xref">Section 4.4</a><a href="#section-7.1.8-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.14">
              <p id="section-7.1.8-1.14.1">N/A<a href="#section-7.1.8-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.16">
              <p id="section-7.1.8-1.16.1">this specification<a href="#section-7.1.8-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.18">
              <p id="section-7.1.8-1.18.1">N/A<a href="#section-7.1.8-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.20">
              <p id="section-7.1.8-1.20.1">N/A<a href="#section-7.1.8-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-7.1.8-1.22.1">
                <dt id="section-7.1.8-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.8-1.22.1.2">N/A<a href="#section-7.1.8-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.8-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.8-1.22.1.4">N/A<a href="#section-7.1.8-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.8-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.8-1.22.1.6">N/A<a href="#section-7.1.8-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.8-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.8-1.22.1.8">N/A<a href="#section-7.1.8-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.24">
              <p id="section-7.1.8-1.24.1">see Authors' Addresses section<a href="#section-7.1.8-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.26">
              <p id="section-7.1.8-1.26.1">COMMON<a href="#section-7.1.8-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.28">
              <p id="section-7.1.8-1.28.1">N/A<a href="#section-7.1.8-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.30">
              <p id="section-7.1.8-1.30.1">see Authors' Addresses section<a href="#section-7.1.8-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.8-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.8-1.32">
              <p id="section-7.1.8-1.32.1">IESG<a href="#section-7.1.8-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="messagedap-collect-req-media-type">
<section id="section-7.1.9">
          <h4 id="name-message-dap-collect-req-med">
<a href="#section-7.1.9" class="section-number selfRef">7.1.9. </a><a href="#name-message-dap-collect-req-med" class="section-name selfRef">"message/dap-collect-req" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-7.1.9-1">
            <dt id="section-7.1.9-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.2">
              <p id="section-7.1.9-1.2.1">message<a href="#section-7.1.9-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.4">
              <p id="section-7.1.9-1.4.1">dap-collect-req<a href="#section-7.1.9-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.6">
              <p id="section-7.1.9-1.6.1">N/A<a href="#section-7.1.9-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.8">
              <p id="section-7.1.9-1.8.1">None<a href="#section-7.1.9-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.10">
              <p id="section-7.1.9-1.10.1">only "8bit" or "binary" is permitted<a href="#section-7.1.9-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.12">
              <p id="section-7.1.9-1.12.1">see <a href="#collect-flow" class="xref">Section 4.4</a><a href="#section-7.1.9-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.14">
              <p id="section-7.1.9-1.14.1">N/A<a href="#section-7.1.9-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.16">
              <p id="section-7.1.9-1.16.1">this specification<a href="#section-7.1.9-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.18">
              <p id="section-7.1.9-1.18.1">N/A<a href="#section-7.1.9-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.20">
              <p id="section-7.1.9-1.20.1">N/A<a href="#section-7.1.9-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-7.1.9-1.22.1">
                <dt id="section-7.1.9-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.9-1.22.1.2">N/A<a href="#section-7.1.9-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.9-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.9-1.22.1.4">N/A<a href="#section-7.1.9-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.9-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.9-1.22.1.6">N/A<a href="#section-7.1.9-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.9-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.9-1.22.1.8">N/A<a href="#section-7.1.9-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.24">
              <p id="section-7.1.9-1.24.1">see Authors' Addresses section<a href="#section-7.1.9-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.26">
              <p id="section-7.1.9-1.26.1">COMMON<a href="#section-7.1.9-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.28">
              <p id="section-7.1.9-1.28.1">N/A<a href="#section-7.1.9-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.30">
              <p id="section-7.1.9-1.30.1">see Authors' Addresses section<a href="#section-7.1.9-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.9-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.9-1.32">
              <p id="section-7.1.9-1.32.1">IESG<a href="#section-7.1.9-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="messagedap-collect-req-media-type-1">
<section id="section-7.1.10">
          <h4 id="name-message-dap-collect-req-medi">
<a href="#section-7.1.10" class="section-number selfRef">7.1.10. </a><a href="#name-message-dap-collect-req-medi" class="section-name selfRef">"message/dap-collect-req" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-7.1.10-1">
            <dt id="section-7.1.10-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.2">
              <p id="section-7.1.10-1.2.1">message<a href="#section-7.1.10-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.4">
              <p id="section-7.1.10-1.4.1">dap-collect-req<a href="#section-7.1.10-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.6">
              <p id="section-7.1.10-1.6.1">N/A<a href="#section-7.1.10-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.8">
              <p id="section-7.1.10-1.8.1">None<a href="#section-7.1.10-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.10">
              <p id="section-7.1.10-1.10.1">only "8bit" or "binary" is permitted<a href="#section-7.1.10-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.12">
              <p id="section-7.1.10-1.12.1">see <a href="#collect-flow" class="xref">Section 4.4</a><a href="#section-7.1.10-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.14">
              <p id="section-7.1.10-1.14.1">N/A<a href="#section-7.1.10-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.16">
              <p id="section-7.1.10-1.16.1">this specification<a href="#section-7.1.10-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.18">
              <p id="section-7.1.10-1.18.1">N/A<a href="#section-7.1.10-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.20">
              <p id="section-7.1.10-1.20.1">N/A<a href="#section-7.1.10-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-7.1.10-1.22.1">
                <dt id="section-7.1.10-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.10-1.22.1.2">N/A<a href="#section-7.1.10-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.10-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.10-1.22.1.4">N/A<a href="#section-7.1.10-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.10-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.10-1.22.1.6">N/A<a href="#section-7.1.10-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-7.1.10-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-7.1.10-1.22.1.8">N/A<a href="#section-7.1.10-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.24">
              <p id="section-7.1.10-1.24.1">see Authors' Addresses section<a href="#section-7.1.10-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.26">
              <p id="section-7.1.10-1.26.1">COMMON<a href="#section-7.1.10-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.28">
              <p id="section-7.1.10-1.28.1">N/A<a href="#section-7.1.10-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.30">
              <p id="section-7.1.10-1.30.1">see Authors' Addresses section<a href="#section-7.1.10-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-7.1.10-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-7.1.10-1.32">
              <p id="section-7.1.10-1.32.1">IESG<a href="#section-7.1.10-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="upload-extension-registry">
<section id="section-7.2">
        <h3 id="name-upload-extension-registry">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-upload-extension-registry" class="section-name selfRef">Upload Extension Registry</a>
        </h3>
<p id="section-7.2-1">This document requests creation of a new registry for extensions to the Upload
protocol. This registry should contain the following columns:<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">[TODO: define how we want to structure this registry when the time comes]<a href="#section-7.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="urn-space">
<section id="section-7.3">
        <h3 id="name-urn-sub-namespace-for-dap-u">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-urn-sub-namespace-for-dap-u" class="section-name selfRef">URN Sub-namespace for DAP (urn:ietf:params:ppm:dap)</a>
        </h3>
<p id="section-7.3-1">The following value [will be/has been] registered in the "IETF URN
Sub-namespace for Registered Protocol Parameter Identifiers" registry,
following the template in <span>[<a href="#RFC3553" class="xref">RFC3553</a>]</span>:<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3-2">
<pre>
Registry name:  dap

Specification:  [[THIS DOCUMENT]]

Repository:  http://www.iana.org/assignments/dap

Index value:  No transformation needed.
</pre><a href="#section-7.3-2" class="pilcrow">¶</a>
</div>
<p id="section-7.3-3">Initial contents: The types and descriptions in the table in
<a href="#errors" class="xref">Section 3.1</a> above, with the Reference field set to point to this
specification.<a href="#section-7.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="acknowledgements">
<section id="section-8">
      <h2 id="name-acknowledgements">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-8-1">The text in <a href="#message-transport" class="xref">Section 3</a> is based extensively on <span>[<a href="#RFC8555" class="xref">RFC8555</a>]</span><a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.thomson-http-oblivious">[I-D.thomson-http-oblivious]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span> and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Oblivious HTTP"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-thomson-http-oblivious-02</span>, <time datetime="2021-08-24" class="refDate">24 August 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-thomson-http-oblivious-02">https://datatracker.ietf.org/doc/html/draft-thomson-http-oblivious-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2818">[RFC2818]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"HTTP Over TLS"</span>, <span class="seriesInfo">RFC 2818</span>, <span class="seriesInfo">DOI 10.17487/RFC2818</span>, <time datetime="2000-05" class="refDate">May 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2818">https://www.rfc-editor.org/rfc/rfc2818</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3553">[RFC3553]</dt>
        <dd>
<span class="refAuthor">Mealling, M.</span>, <span class="refAuthor">Masinter, L.</span>, <span class="refAuthor">Hardie, T.</span>, and <span class="refAuthor">G. Klyne</span>, <span class="refTitle">"An IETF URN Sub-namespace for Registered Protocol Parameters"</span>, <span class="seriesInfo">BCP 73</span>, <span class="seriesInfo">RFC 3553</span>, <span class="seriesInfo">DOI 10.17487/RFC3553</span>, <time datetime="2003-06" class="refDate">June 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3553">https://www.rfc-editor.org/rfc/rfc3553</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4648">[RFC4648]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span>, <span class="refTitle">"The Base16, Base32, and Base64 Data Encodings"</span>, <span class="seriesInfo">RFC 4648</span>, <span class="seriesInfo">DOI 10.17487/RFC4648</span>, <time datetime="2006-10" class="refDate">October 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4648">https://www.rfc-editor.org/rfc/rfc4648</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5861">[RFC5861]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refTitle">"HTTP Cache-Control Extensions for Stale Content"</span>, <span class="seriesInfo">RFC 5861</span>, <span class="seriesInfo">DOI 10.17487/RFC5861</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5861">https://www.rfc-editor.org/rfc/rfc5861</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7234">[RFC7234]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"Hypertext Transfer Protocol (HTTP/1.1): Caching"</span>, <span class="seriesInfo">RFC 7234</span>, <span class="seriesInfo">DOI 10.17487/RFC7234</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7234">https://www.rfc-editor.org/rfc/rfc7234</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7807">[RFC7807]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span> and <span class="refAuthor">E. Wilde</span>, <span class="refTitle">"Problem Details for HTTP APIs"</span>, <span class="seriesInfo">RFC 7807</span>, <span class="seriesInfo">DOI 10.17487/RFC7807</span>, <time datetime="2016-03" class="refDate">March 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7807">https://www.rfc-editor.org/rfc/rfc7807</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9180">[RFC9180]</dt>
      <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="seriesInfo">RFC 9180</span>, <span class="seriesInfo">DOI 10.17487/RFC9180</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9180">https://www.rfc-editor.org/rfc/rfc9180</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="BBCGGI19">[BBCGGI19]</dt>
        <dd>
<span class="refAuthor">Boneh, D.</span>, <span class="refAuthor">Boyle, E.</span>, <span class="refAuthor">Corrigan-Gibbs, H.</span>, <span class="refAuthor">Gilboa, N.</span>, and <span class="refAuthor">Y. Ishai</span>, <span class="refTitle">"Zero-Knowledge Proofs on Secret-Shared Data via Fully Linear PCPs"</span>, <time datetime="2021-01-05" class="refDate">5 January 2021</time>, <span>&lt;<a href="https://eprint.iacr.org/2019/188">https://eprint.iacr.org/2019/188</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="BBCGGI21">[BBCGGI21]</dt>
        <dd>
<span class="refAuthor">Boneh, D.</span>, <span class="refAuthor">Boyle, E.</span>, <span class="refAuthor">Corrigan-Gibbs, H.</span>, <span class="refAuthor">Gilboa, N.</span>, and <span class="refAuthor">Y. Ishai</span>, <span class="refTitle">"Lightweight Techniques for Private Heavy Hitters"</span>, <time datetime="2021-01-05" class="refDate">5 January 2021</time>, <span>&lt;<a href="https://eprint.iacr.org/2021/017">https://eprint.iacr.org/2021/017</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CGB17">[CGB17]</dt>
        <dd>
<span class="refAuthor">Corrigan-Gibbs, H.</span> and <span class="refAuthor">D. Boneh</span>, <span class="refTitle">"Prio: Private, Robust, and Scalable Computation of Aggregate Statistics"</span>, <time datetime="2017-03-14" class="refDate">14 March 2017</time>, <span>&lt;<a href="https://crypto.stanford.edu/prio/paper.pdf">https://crypto.stanford.edu/prio/paper.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Dou02">[Dou02]</dt>
        <dd>
<span class="refAuthor">Douceur, J.</span>, <span class="refTitle">"The Sybil Attack"</span>, <time datetime="2022-10-10" class="refDate">10 October 2022</time>, <span>&lt;<a href="https://link.springer.com/chapter/10.1007/3-540-45748-8_24">https://link.springer.com/chapter/10.1007/3-540-45748-8_24</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8555">[RFC8555]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Hoffman-Andrews, J.</span>, <span class="refAuthor">McCarney, D.</span>, and <span class="refAuthor">J. Kasten</span>, <span class="refTitle">"Automatic Certificate Management Environment (ACME)"</span>, <span class="seriesInfo">RFC 8555</span>, <span class="seriesInfo">DOI 10.17487/RFC8555</span>, <time datetime="2019-03" class="refDate">March 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8555">https://www.rfc-editor.org/rfc/rfc8555</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Vad16">[Vad16]</dt>
        <dd>
<span class="refAuthor">Vadhan, S.</span>, <span class="refTitle">"The Complexity of Differential Privacy"</span>, <time datetime="2016-08-09" class="refDate">9 August 2016</time>, <span>&lt;<a href="https://privacytools.seas.harvard.edu/files/privacytools/files/complexityprivacy_1.pdf">https://privacytools.seas.harvard.edu/files/privacytools/files/complexityprivacy_1.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="VDAF">[VDAF]</dt>
      <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Patton, C.</span>, and <span class="refAuthor">P. Schoppmann</span>, <span class="refTitle">"Verifiable Distributed Aggregation Functions"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-vdaf-00</span>, <time datetime="2022-04-27" class="refDate">27 April 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-00">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Tim Geoghegan</span></div>
<div dir="auto" class="left"><span class="org">ISRG</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:timgeog+ietf@gmail.com" class="email">timgeog+ietf@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher Patton</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:chrispatton+ietf@gmail.com" class="email">chrispatton+ietf@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Eric Rescorla</span></div>
<div dir="auto" class="left"><span class="org">Mozilla</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ekr@rtfm.com" class="email">ekr@rtfm.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher A. Wood</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:caw@heapingbits.net" class="email">caw@heapingbits.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
